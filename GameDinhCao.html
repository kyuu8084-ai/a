<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduCraft: Ultimate Monster Collection</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --bg-color: #000;
            --ui-bg: rgba(20, 10, 30, 0.95);
            --accent: #d35400; 
            --danger: #c0392b;
            --magic: #9b59b6; 
        }

        body {
            margin: 0; padding: 0;
            background: #111;
            overflow: hidden;
            font-family: 'VT323', monospace;
            touch-action: none; 
            user-select: none;
        }

        canvas {
            display: block;
            image-rendering: pixelated; 
        }

        /* UI Overlays */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 15px; box-sizing: border-box;
            z-index: 10;
        }

        /* HUD */
        .hud-bar {
            display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto;
        }
        .stat-box {
            background: var(--ui-bg); border: 3px solid #8e44ad;
            padding: 10px 20px; color: #fff; font-size: 26px;
            box-shadow: 0 0 10px #8e44ad;
            min-width: 180px; text-shadow: 2px 2px #000;
        }
        .hp-container {
            width: 100%; height: 15px; background: #333; margin-top: 5px; border: 1px solid #fff;
        }
        .hp-fill {
            width: 100%; height: 100%; background: linear-gradient(90deg, #e74c3c, #c0392b);
            transition: width 0.2s;
        }

        /* Toast Message */
        #toast-msg {
            position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9); color: #f1c40f; padding: 20px 40px;
            border: 4px solid var(--danger); border-radius: 5px;
            font-size: 35px; opacity: 0; transition: opacity 0.3s;
            pointer-events: none; z-index: 999; text-align: center;
            text-shadow: 2px 2px #000;
        }
        #toast-msg.show { opacity: 1; animation: bounce 0.5s; }

        /* Ambush Overlay */
        #ambush-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(100, 0, 100, 0.3); 
            display: none; justify-content: center; align-items: center;
            z-index: 50; animation: flashRed 0.5s infinite;
        }
        .ambush-text {
            font-size: 80px; color: #fff; text-shadow: 5px 5px #8e44ad;
            background: rgba(0,0,0,0.8); padding: 20px 40px; border: 5px solid #8e44ad;
            transform: rotate(-5deg);
        }

        /* Controls */
        .controls-area {
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-bottom: 20px; pointer-events: auto; opacity: 0.9;
        }
        .dpad { position: relative; width: 160px; height: 160px; }
        .dbtn {
            position: absolute; width: 55px; height: 55px;
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.5);
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 24px; cursor: pointer; border-radius: 8px;
            backdrop-filter: blur(2px);
        }
        .dbtn:active { background: rgba(255,255,255,0.3); transform: scale(0.95); }
        .d-up { top: 0; left: 52px; } .d-down { bottom: 0; left: 52px; }
        .d-left { top: 52px; left: 0; } .d-right { top: 52px; right: 0; }
        
        .fire-group {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
        }
        .fire-btn {
            width: 90px; height: 90px; background: rgba(192, 57, 43, 0.8);
            border: 4px solid #e74c3c; border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            color: #fff; font-weight: bold; font-size: 22px;
            cursor: pointer; box-shadow: 0 0 20px rgba(231, 76, 60, 0.6);
        }
        .fire-btn:active { background: #ff0000; transform: scale(0.95); }
        .ammo-count {
            background: #000; color: #f1c40f; padding: 5px 10px; border: 1px solid #fff;
            font-size: 20px; font-weight: bold;
        }

        /* Modals */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; animation: popIn 0.3s; }
        
        .dialog-box {
            background: #2c3e50; border: 6px solid #8e44ad;
            width: 90%; max-width: 700px; padding: 30px;
            color: #fff; text-align: center; box-shadow: 0 0 50px rgba(142, 68, 173, 0.6);
            border-radius: 10px;
        }
        
        .question-text { font-size: 28px; margin: 20px 0; line-height: 1.4; color: #ecf0f1; min-height: 80px; }
        .subject-tag { display: inline-block; background: #e67e22; padding: 4px 10px; font-size: 20px; border-radius: 4px; margin-bottom: 10px; text-transform: uppercase;}

        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .ans-btn {
            background: #34495e; border: 2px solid #7f8c8d; color: #fff;
            padding: 15px; font-family: 'VT323', monospace; font-size: 24px;
            cursor: pointer; transition: 0.1s;
        }
        .ans-btn:hover { background: #8e44ad; color: #fff; border-color: #fff; }

        .boss-input {
            width: 70%; padding: 10px; font-size: 30px; text-align: center;
            background: #000; border: 3px solid var(--magic); color: #fff;
            font-family: 'VT323', monospace; margin: 20px 0;
        }

        @keyframes flashRed { 0% {opacity:0.5;} 50% {opacity:1;} 100% {opacity:0.5;} }
        @keyframes popIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @keyframes bounce { 0% {transform: translate(-50%, -50%) scale(0.8);} 50% {transform: translate(-50%, -50%) scale(1.1);} 100% {transform: translate(-50%, -50%) scale(1);} }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div id="ambush-overlay"><div class="ambush-text">‚ö† QU√ÅI V·∫¨T T·∫§N C√îNG! ‚ö†</div></div>
        <div id="toast-msg">CH∆ØA ƒê·ª¶ KILLS!</div>

        <div class="ui-layer">
            <div class="hud-bar">
                <div class="stat-box">
                    HP: <span id="hp-text">100</span>
                    <div class="hp-container"><div class="hp-fill" id="hp-bar"></div></div>
                </div>
                <div class="stat-box" style="text-align: right;">
                    KILLS: <span id="score" style="color: var(--accent)">0</span>/30<br>
                    <span style="font-size: 18px; color: #aaa;">S·∫Ω B·ªã Ph·ª•c K√≠ch Sau: <span id="ambush-timer">10</span>s</span>
                </div>
            </div>

            <div class="controls-area">
                <div class="dpad">
                    <div class="dbtn d-up" data-key="ArrowUp">‚ñ≤</div>
                    <div class="dbtn d-down" data-key="ArrowDown">‚ñº</div>
                    <div class="dbtn d-left" data-key="ArrowLeft">‚óÄ</div>
                    <div class="dbtn d-right" data-key="ArrowRight">‚ñ∂</div>
                </div>
                <div class="fire-group">
                    <div class="ammo-count">ƒê·∫†N: <span id="ammo-val">15</span></div>
                    <div class="fire-btn" id="btn-fire">B·∫ÆN</div>
                </div>
            </div>
        </div>

        <div id="start-screen" class="modal active">
            <div class="dialog-box" style="background: linear-gradient(to bottom, #2c3e50, #000);">
                <h1 style="font-size: 70px; color: #9b59b6; margin: 0; text-shadow: 4px 4px #000;">TH·ª¶ Lƒ®NH DI·ªÜT R·ªíNG</h1>
                <h3 style="color: #fff; letter-spacing: 3px;">FULL MONSTER EDITION</h3>
                <p style="font-size: 22px;">Nhi·ªám v·ª•: Ti√™u di·ªát R·ªíNG ENDER </p>
                <div style="font-size: 18px; background: rgba(0,0,0,0.5); padding: 15px; margin: 20px; border: 2px solid #8e44ad; text-align: left;">
                    ‚öîÔ∏è <b>HARDCORE:</b> B·∫°n ch·ªâ c√≥ <b>15 vi√™n ƒë·∫°n</b>. Kh√¥ng th·ªÉ h·ªìi ƒë·∫°n!<br>
                    üßü <b>NHI·ªÜM V·ª§:</b> H·∫° g·ª•c <b>30 Qu√°i v·∫≠t</b> ƒë·ªÉ khi·∫øn R·ªíNG ENDER th·ª©c gi·∫•c.<br>
                    üêâ <b>BOSS:</b> R·ªíNG ENDER ƒë√£ hi·ªán nguy√™n h√¨nh (Full Body).<br>
                    üß† <b>TR√ç TU·ªÜ:</b> Tr·∫£ l·ªùi 8 c√¢u h·ªèi khi ƒë·∫•u R·ªíNG ENDER ƒë·ªÉ chi·∫øn th·∫Øng.
                </div>
                <button class="ans-btn" style="background: #27ae60; border-color: #fff; width: 200px; font-size: 30px;" onclick="startGame()">KH·ªûI H√ÄNH</button>
            </div>
        </div>

        <div id="battle-modal" class="modal">
            <div class="dialog-box">
                <h2 id="battle-title" style="color: var(--danger); font-size: 40px;">B·ªä T·∫§N C√îNG!</h2>
                <div class="question-text" id="battle-question">...</div>
                <div class="options-grid" id="battle-options"></div>
            </div>
        </div>

        <div id="boss-modal" class="modal">
            <div class="dialog-box" style="border-color: #c0392b; background: #2b0000;">
                <h2 style="color: #e74c3c; font-size: 50px; text-shadow: 0 0 10px #fff;">R·ªíNG ENDER</h2>
                <div style="font-size: 24px; margin-bottom: 10px; color: #fff;">
                    ‚è≥ Th·ªùi gian: <span id="boss-timer-val">30</span>s
                </div>
                <div class="question-text" id="boss-question">...</div>
                <input type="text" class="boss-input" id="boss-input" placeholder="Nh·∫≠p ƒë√°p √°n..." autocomplete="off" style="border-color: #e74c3c;">
                <br>
                <button class="ans-btn" style="background: #fff; color: #000; width: 150px;" onclick="checkBossAnswer()">T·∫§N C√îNG</button>
                <p style="margin-top: 10px;">Thanh m√°u Boss: <span id="boss-progress">1</span>/8</p>
            </div>
        </div>

        <div id="end-screen" class="modal">
            <div class="dialog-box">
                <h2 id="end-title" style="font-size: 60px;">VICTORY!</h2>
                <p id="end-msg" style="font-size: 30px;">...</p>
                <div id="firework-container"></div>
                <p style="color: #aaa; font-size: 20px;">(T·ª± ƒë·ªông ch∆°i l·∫°i sau 4 gi√¢y...)</p>
            </div>
        </div>
    </div>

<script>
// --- DATA WAREHOUSE ---
const RAW_QUESTIONS = [
    
    // --- L·ªäCH S·ª¨ (Vi·ªát Nam & Th·∫ø Gi·ªõi) ---
    { s: "L·ªãch S·ª≠", q: "V·ªã vua cu·ªëi c√πng c·ªßa tri·ªÅu ƒë·∫°i phong ki·∫øn Vi·ªát Nam l√† ai?", a: ["B·∫£o ƒê·∫°i", "Kh·∫£i ƒê·ªãnh", "Duy T√¢n", "T·ª± ƒê·ª©c"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Ai l√† t√°c gi·∫£ c·ªßa t√°c ph·∫©m 'B√¨nh Ng√¥ ƒê·∫°i C√°o'?", a: ["Nguy·ªÖn Tr√£i", "L√™ L·ª£i", "Nguy·ªÖn Du", "Tr·∫ßn H∆∞ng ƒê·∫°o"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Cu·ªôc c√°ch m·∫°ng c√¥ng nghi·ªáp l·∫ßn th·ª© nh·∫•t b·∫Øt ƒë·∫ßu t·∫°i qu·ªëc gia n√†o?", a: ["Anh", "Ph√°p", "M·ªπ", "ƒê·ª©c"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Chi·∫øn tranh th·∫ø gi·ªõi th·ª© hai k·∫øt th√∫c v√†o nƒÉm n√†o?", a: ["1945", "1939", "1954", "1918"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "V·ªã t∆∞·ªõng n√†o ƒë√£ ch·ªâ huy chi·∫øn d·ªãch H·ªì Ch√≠ Minh nƒÉm 1975?", a: ["VƒÉn Ti·∫øn D≈©ng", "V√µ Nguy√™n Gi√°p", "Nguy·ªÖn Ch√≠ Thanh", "Ho√†ng VƒÉn Th√°i"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "T√™n g·ªçi kh√°c c·ªßa th√†nh ph·ªë S√†i G√≤n tr∆∞·ªõc nƒÉm 1698 l√† g√¨?", a: ["Prey Nokor", "Gia ƒê·ªãnh", "B·∫øn Ngh√©", "Ch·ª£ L·ªõn"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "N·ªØ ho√†ng duy nh·∫•t trong l·ªãch s·ª≠ phong ki·∫øn Vi·ªát Nam l√† ai?", a: ["L√Ω Chi√™u Ho√†ng", "D∆∞∆°ng V√¢n Nga", "·ª∂ Lan", "Huy·ªÅn Tr√¢n C√¥ng Ch√∫a"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Ai l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë·∫∑t ch√¢n l√™n M·∫∑t TrƒÉng?", a: ["Neil Armstrong", "Yuri Gagarin", "Buzz Aldrin", "Michael Collins"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Phong tr√†o C·∫ßn V∆∞∆°ng do ai ph√°t ƒë·ªông?", a: ["Vua H√†m Nghi", "Vua Duy T√¢n", "Phan ƒê√¨nh Ph√πng", "T√¥n Th·∫•t Thuy·∫øt"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "NƒÉm 1789 g·∫Øn li·ªÅn v·ªõi s·ª± ki·ªán l·ªãch s·ª≠ n√†o c·ªßa th·∫ø gi·ªõi?", a: ["C√°ch m·∫°ng t∆∞ s·∫£n Ph√°p", "C√°ch m·∫°ng th√°ng M∆∞·ªùi Nga", "N∆∞·ªõc M·ªπ gi√†nh ƒë·ªôc l·∫≠p", "Ph√°t ki·∫øn ƒë·ªãa l√Ω"], c: 0 },

    // --- ƒê·ªäA L√ù ---
    { s: "ƒê·ªãa L√≠", q: "T·ªânh n√†o c·ªßa Vi·ªát Nam c√≥ ƒë∆∞·ªùng bi√™n gi·ªõi gi√°p v·ªõi c·∫£ L√†o v√† Campuchia?", a: ["Kon Tum", "Gia Lai", "ƒê·∫Øk L·∫Øk", "ƒêi·ªán Bi√™n"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "H·ªì n∆∞·ªõc ng·ªçt l·ªõn nh·∫•t th·∫ø gi·ªõi (theo di·ªán t√≠ch) l√† h·ªì n√†o?", a: ["H·ªì th∆∞·ª£ng (Superior)", "H·ªì Victoria", "H·ªì Baikal", "H·ªì Michigan"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Th·ªß ƒë√¥ c·ªßa √öc (Australia) l√† th√†nh ph·ªë n√†o?", a: ["Canberra", "Sydney", "Melbourne", "Perth"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Sa m·∫°c l·ªõn nh·∫•t th·∫ø gi·ªõi l√†?", a: ["Sa m·∫°c Nam C·ª±c", "Sa m·∫°c Sahara", "Sa m·∫°c Gobi", "Sa m·∫°c Kalahari"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "ƒê·∫•t n∆∞·ªõc n√†o ƒë∆∞·ª£c m·ªánh danh l√† 'X·ª© s·ªü v·∫°n ƒë·∫£o'?", a: ["Indonesia", "Philippines", "Nh·∫≠t B·∫£n", "Malaysia"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "D√≤ng s√¥ng n√†o ch·∫£y qua nhi·ªÅu qu·ªëc gia nh·∫•t th·∫ø gi·ªõi?", a: ["S√¥ng Danube", "S√¥ng Nile", "S√¥ng Amazon", "S√¥ng M√™ K√¥ng"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "N∆°i n√†o ƒë∆∞·ª£c xem l√† ƒëi·ªÉm c·ª±c ƒê√¥ng c·ªßa T·ªï qu·ªëc Vi·ªát Nam (tr√™n ƒë·∫•t li·ªÅn)?", a: ["M≈©i ƒê√¥i (Kh√°nh H√≤a)", "M≈©i ƒêi·ªán (Ph√∫ Y√™n)", "M≈©i C√† Mau", "M≈©i Ng·ªçc (Qu·∫£ng Ninh)"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "T·∫ßng kh√≠ quy·ªÉn n√†o n·∫±m s√°t m·∫∑t ƒë·∫•t nh·∫•t?", a: ["T·∫ßng ƒë·ªëi l∆∞u", "T·∫ßng b√¨nh l∆∞u", "T·∫ßng trung l∆∞u", "T·∫ßng ƒëi·ªán ly"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Eo bi·ªÉn n√†o n·ªëi li·ªÅn ƒê·ªãa Trung H·∫£i v√† ƒê·∫°i T√¢y D∆∞∆°ng?", a: ["Eo bi·ªÉn Gibraltar", "Eo bi·ªÉn Malacca", "Eo bi·ªÉn Bering", "Eo bi·ªÉn Hormuz"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Qu·ªëc gia n√†o c√≥ di·ªán t√≠ch nh·ªè nh·∫•t th·∫ø gi·ªõi?", a: ["Vatican", "Monaco", "Singapore", "Maldives"], c: 0 },

    // --- V·∫¨T L√ù ---
    { s: "V·∫≠t L√≠", q: "Hi·ªán t∆∞·ª£ng c·∫ßu v·ªìng l√† k·∫øt qu·∫£ c·ªßa qu√° tr√¨nh n√†o?", a: ["T√°n s·∫Øc √°nh s√°ng", "Nhi·ªÖu x·∫° √°nh s√°ng", "Giao thoa √°nh s√°ng", "H·∫•p th·ª• √°nh s√°ng"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê∆°n v·ªã ƒëo ƒëi·ªán dung l√† g√¨?", a: ["Farad (F)", "Henry (H)", "Tesla (T)", "Weber (Wb)"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Trong ch√¢n kh√¥ng, s√≥ng n√†o sau ƒë√¢y kh√¥ng truy·ªÅn ƒë∆∞·ª£c?", a: ["S√≥ng √¢m", "S√≥ng √°nh s√°ng", "S√≥ng v√¥ tuy·∫øn", "Tia X"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê·ªãnh lu·∫≠t I Newton c√≤n ƒë∆∞·ª£c g·ªçi l√† ƒë·ªãnh lu·∫≠t g√¨?", a: ["Qu√°n t√≠nh", "B·∫£o to√†n ƒë·ªông l∆∞·ª£ng", "V·∫°n v·∫≠t h·∫•p d·∫´n", "Ph·∫£n l·ª±c"], c: 0 },
    { s: "V·∫≠t L√≠", q: "H·∫°t nh√¢n nguy√™n t·ª≠ ƒë∆∞·ª£c c·∫•u t·∫°o b·ªüi nh·ªØng h·∫°t n√†o?", a: ["Proton v√† Neutron", "Proton v√† Electron", "Neutron v√† Electron", "Ch·ªâ c√≥ Proton"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Ng∆∞·ªùi ta d√πng d·ª•ng c·ª• n√†o ƒë·ªÉ ƒëo √°p su·∫•t kh√≠ quy·ªÉn?", a: ["√Åp k·∫ø (Barometer)", "Nhi·ªát k·∫ø", "V√¥n k·∫ø", "L·ª±c k·∫ø"], c: 0 },
    { s: "V·∫≠t L√≠", q: "M√°y bi·∫øn √°p ho·∫°t ƒë·ªông d·ª±a tr√™n hi·ªán t∆∞·ª£ng g√¨?", a: ["C·∫£m ·ª©ng ƒëi·ªán t·ª´", "T·ª± c·∫£m", "C·ªông h∆∞·ªüng ƒëi·ªán", "D√≤ng ƒëi·ªán Foucault"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Khi √°nh s√°ng truy·ªÅn t·ª´ kh√¥ng kh√≠ v√†o n∆∞·ªõc, v·∫≠n t·ªëc c·ªßa n√≥ s·∫Ω nh∆∞ th·∫ø n√†o?", a: ["Gi·∫£m ƒëi", "TƒÉng l√™n", "Kh√¥ng ƒë·ªïi", "TƒÉng g·∫•p ƒë√¥i"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê∆°n v·ªã ƒëo c√¥ng su·∫•t l√† g√¨?", a: ["Watt", "Joule", "Newton", "Hertz"], c: 0 },
    { s: "V·∫≠t L√≠", q: "V·∫≠t ch·∫•t ·ªü tr·∫°ng th√°i n√†o c√≥ h√¨nh d·∫°ng v√† th·ªÉ t√≠ch x√°c ƒë·ªãnh?", a: ["R·∫Øn", "L·ªèng", "Kh√≠", "Plasma"], c: 0 },

    // --- H√ìA H·ªåC ---
    { s: "H√≥a H·ªçc", q: "Kim lo·∫°i n√†o d·∫´n ƒëi·ªán t·ªët nh·∫•t?", a: ["B·∫°c", "ƒê·ªìng", "V√†ng", "Nh√¥m"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Kh√≠ n√†o l√† th√†nh ph·∫ßn ch√≠nh c·ªßa kh√≠ thi√™n nhi√™n (biogas)?", a: ["Metan (CH4)", "Etan (C2H6)", "Propan (C3H8)", "Butan (C4H10)"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Nguy√™n t·ªë n√†o l√† nguy√™n t·ªë ph·ªï bi·∫øn nh·∫•t trong v·ªè Tr√°i ƒê·∫•t?", a: ["Oxy", "Silic", "Nh√¥m", "S·∫Øt"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Dung d·ªãch l√†m qu·ª≥ t√≠m chuy·ªÉn sang m√†u ƒë·ªè l√†?", a: ["Axit", "Bazo", "Mu·ªëi", "N∆∞·ªõc c·∫•t"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Th·ªßy ng√¢n (Hg) ·ªü ƒëi·ªÅu ki·ªán th∆∞·ªùng ·ªü tr·∫°ng th√°i n√†o?", a: ["L·ªèng", "R·∫Øn", "Kh√≠", "Plasma"], c: 0 },
    { s: "H√≥a H·ªçc", q: "C√¥ng th·ª©c h√≥a h·ªçc c·ªßa 'V√¥i s·ªëng' l√† g√¨?", a: ["CaO", "CaCO3", "Ca(OH)2", "CaCl2"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Kh√≠ c∆∞·ªùi (Laughing gas) c√≥ c√¥ng th·ª©c l√† g√¨?", a: ["N2O", "NO2", "NO", "N2"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Nguy√™n t·ªë h√≥a h·ªçc n√†o c√≥ k√Ω hi·ªáu l√† 'K'?", a: ["Kali", "K·∫Ωm", "Krypton", "Canxi"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Ch·∫•t n√†o ƒë∆∞·ª£c m·ªánh danh l√† 'V√†ng ƒëen'?", a: ["D·∫ßu m·ªè", "Than ƒë√°", "C√† ph√™", "H·∫°t ti√™u"], c: 0 },
    { s: "H√≥a H·ªçc", q: "H·ª£p ch·∫•t h·ªØu c∆° ƒë∆°n gi·∫£n nh·∫•t l√† g√¨?", a: ["Metan", "Etan", "Metanol", "Benzen"], c: 0 },

    // --- SINH H·ªåC ---
    { s: "Sinh H·ªçc", q: "B√†o quan n√†o ƒë∆∞·ª£c coi l√† 'nh√† m√°y nƒÉng l∆∞·ª£ng' c·ªßa t·∫ø b√†o?", a: ["Ty th·ªÉ", "L·ª•c l·∫°p", "Riboxom", "B·ªô m√°y Golgi"], c: 0 },
    { s: "Sinh H·ªçc", q: "Nh√≥m m√°u n√†o ƒë∆∞·ª£c g·ªçi l√† nh√≥m m√°u 'chuy√™n cho'?", a: ["O", "AB", "A", "B"], c: 0 },
    { s: "Sinh H·ªçc", q: "ƒê·ªông v·∫≠t n√†o c√≥ tu·ªïi th·ªç trung b√¨nh cao nh·∫•t?", a: ["R√πa", "Voi", "C√° voi xanh", "ƒê·∫°i b√†ng"], c: 0 },
    { s: "Sinh H·ªçc", q: "Ph·∫ßn l·ªõn qu√° tr√¨nh h·∫•p th·ª• ch·∫•t dinh d∆∞·ª°ng di·ªÖn ra ·ªü ƒë√¢u?", a: ["Ru·ªôt non", "D·∫° d√†y", "Ru·ªôt gi√†", "Th·ª±c qu·∫£n"], c: 0 },
    { s: "Sinh H·ªçc", q: "H·ªá th·∫ßn kinh c·ªßa con ng∆∞·ªùi g·ªìm hai b·ªô ph·∫≠n ch√≠nh l√† g√¨?", a: ["Trung ∆∞∆°ng v√† ngo·∫°i bi√™n", "N√£o v√† t·ªßy s·ªëng", "N√£o v√† d√¢y th·∫ßn kinh", "C·∫£m gi√°c v√† v·∫≠n ƒë·ªông"], c: 0 },
    { s: "Sinh H·ªçc", q: "Lo√†i th·ª±c v·∫≠t n√†o kh√¥ng c√≥ hoa?", a: ["D∆∞∆°ng x·ªâ", "L√∫a", "Sen", "M∆∞·ªõp"], c: 0 },
    { s: "Sinh H·ªçc", q: "Hormone Insulin do tuy·∫øn n√†o ti·∫øt ra?", a: ["T·ª•y", "Gi√°p", "Y√™n", "Th∆∞·ª£ng th·∫≠n"], c: 0 },
    { s: "Sinh H·ªçc", q: "ƒê∆°n v·ªã c·∫•u t·∫°o nh·ªè nh·∫•t c·ªßa s·ª± s·ªëng l√† g√¨?", a: ["T·∫ø b√†o", "M√¥", "C∆° quan", "Ph√¢n t·ª≠"], c: 0 },
    { s: "Sinh H·ªçc", q: "Trong t·∫ø b√†o th·ª±c v·∫≠t, th√†nh ph·∫ßn n√†o gi√∫p c√¢y ƒë·ª©ng v·ªØng?", a: ["V√°ch t·∫ø b√†o", "M√†ng sinh ch·∫•t", "Kh√¥ng b√†o", "L·ª•c l·∫°p"], c: 0 },
    { s: "Sinh H·ªçc", q: "Th√∫ m·ªè v·ªãt l√† lo√†i ƒë·ªông v·∫≠t ƒë·∫ª g√¨?", a: ["ƒê·∫ª tr·ª©ng", "ƒê·∫ª con", "ƒê·∫ª tr·ª©ng thai", "Ph√¢n ƒë√¥i"], c: 0 },

    // --- VƒÇN H·ªåC ---
    { s: "VƒÉn H·ªçc", q: "T√°c ph·∫©m 'S·ªë ƒë·ªè' l√† c·ªßa nh√† vƒÉn n√†o?", a: ["V≈© Tr·ªçng Ph·ª•ng", "Nam Cao", "Ng√¥ T·∫•t T·ªë", "Nguy·ªÖn C√¥ng Hoan"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Nh√† vƒÉn n√†o ƒë∆∞·ª£c m·ªánh danh l√† '√îng vua ph√≥ng s·ª± ƒë·∫•t B·∫Øc'?", a: ["V≈© Tr·ªçng Ph·ª•ng", "Nguy√™n H·ªìng", "Th·∫°ch Lam", "Nguy·ªÖn Tu√¢n"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Nh√¢n v·∫≠t Sherlock Holmes xu·∫•t hi·ªán l·∫ßn ƒë·∫ßu trong t√°c ph·∫©m n√†o?", a: ["Chi·∫øc nh·∫´n t√¨nh c·ªù", "D·∫•u b·ªô t·ª©", "V·ª• √°n m·∫°ng ·ªü Baskerville", "Thung l≈©ng kh·ªßng khi·∫øp"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Ai l√† t√°c gi·∫£ c·ªßa b·ªô ti·ªÉu thuy·∫øt 'Harry Potter'?", a: ["J.K. Rowling", "J.R.R. Tolkien", "Stephen King", "Dan Brown"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "B√†i th∆° 'T√¢y Ti·∫øn' do ai s√°ng t√°c?", a: ["Quang D≈©ng", "Ch√≠nh H·ªØu", "Ph·∫°m Ti·∫øn Du·∫≠t", "T·ªë H·ªØu"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Trong 'Truy·ªán Ki·ªÅu', t√™n th·∫≠t c·ªßa Ho·∫°n Th∆∞ l√† g√¨?", a: ["Kh√¥ng ƒë∆∞·ª£c nh·∫Øc ƒë·∫øn", "Th√∫y Ho·∫°n", "Ti·ªÉu Th∆∞", "Ki·ªÅu Loan"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Gi·∫£i Nobel VƒÉn h·ªçc ƒë·∫ßu ti√™n ƒë∆∞·ª£c trao v√†o nƒÉm n√†o?", a: ["1901", "1900", "1896", "1910"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "T√°c ph·∫©m 'Chi·∫øc l∆∞·ª£c ng√†' vi·∫øt v·ªÅ t√¨nh c·∫£m g√¨?", a: ["Cha con", "M·∫π con", "V·ª£ ch·ªìng", "ƒê·ªìng ƒë·ªôi"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "ƒê·∫°i thi h√†o William Shakespeare l√† ng∆∞·ªùi n∆∞·ªõc n√†o?", a: ["Anh", "Ph√°p", "M·ªπ", "ƒê·ª©c"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "B√†i th∆° 'S√≥ng' c·ªßa Xu√¢n Qu·ª≥nh ƒë∆∞·ª£c in trong t·∫≠p th∆° n√†o?", a: ["Hoa d·ªçc chi·∫øn h√†o", "Gi√≥ l√†o c√°t tr·∫Øng", "T·ª± h√°t", "T∆° t·∫±m - Ch·ªìi bi·∫øc"], c: 0 },

    // --- TO√ÅN H·ªåC ---
    { s: "To√°n", q: "T·ªïng c√°c g√≥c trong c·ªßa m·ªôt t·ª© gi√°c l·ªìi b·∫±ng bao nhi√™u?", a: ["360 ƒë·ªô", "180 ƒë·ªô", "90 ƒë·ªô", "270 ƒë·ªô"], c: 0 },
    { s: "To√°n", q: "S·ªë nguy√™n t·ªë ch·∫µn duy nh·∫•t l√† s·ªë m·∫•y?", a: ["2", "4", "0", "Kh√¥ng c√≥"], c: 0 },
    { s: "To√°n", q: "H√¨nh ƒëa di·ªán ƒë·ªÅu lo·∫°i {4;3} l√† h√¨nh g√¨?", a: ["H√¨nh l·∫≠p ph∆∞∆°ng", "H√¨nh t·ª© di·ªán ƒë·ªÅu", "H√¨nh b√°t di·ªán ƒë·ªÅu", "H√¨nh 12 m·∫∑t ƒë·ªÅu"], c: 0 },
    { s: "To√°n", q: "CƒÉn b·∫≠c hai s·ªë h·ªçc c·ªßa 225 l√†?", a: ["15", "25", "12", "14"], c: 0 },
    { s: "To√°n", q: "Trong h·ªá nh·ªã ph√¢n, s·ªë 10 t∆∞∆°ng ·ª©ng v·ªõi s·ªë m·∫•y trong h·ªá th·∫≠p ph√¢n?", a: ["2", "10", "1", "4"], c: 0 },
    { s: "To√°n", q: "ƒê·ªãnh l√Ω Pytago √°p d·ª•ng cho lo·∫°i tam gi√°c n√†o?", a: ["Tam gi√°c vu√¥ng", "Tam gi√°c ƒë·ªÅu", "Tam gi√°c c√¢n", "M·ªçi tam gi√°c"], c: 0 },
    { s: "To√°n", q: "S·ªë ngh·ªãch ƒë·∫£o c·ªßa ph√¢n s·ªë 3/4 l√†?", a: ["4/3", "-3/4", "-4/3", "1"], c: 0 },
    { s: "To√°n", q: "H√¨nh thoi c√≥ hai ƒë∆∞·ªùng ch√©o nh∆∞ th·∫ø n√†o?", a: ["Vu√¥ng g√≥c v·ªõi nhau", "B·∫±ng nhau", "Song song", "Tr√πng nhau"], c: 0 },
    { s: "To√°n", q: "Logarit c∆° s·ªë 10 c·ªßa 100 b·∫±ng bao nhi√™u?", a: ["2", "10", "100", "1"], c: 0 },
    { s: "To√°n", q: "S·ªë Pi (œÄ) l√† lo·∫°i s·ªë g√¨?", a: ["S·ªë v√¥ t·ªâ", "S·ªë h·ªØu t·ªâ", "S·ªë nguy√™n", "S·ªë ·∫£o"], c: 0 },

    // --- C√îNG NGH·ªÜ & TIN H·ªåC ---
    { s: "C√¥ng Ngh·ªá", q: "Cha ƒë·∫ª c·ªßa h·ªá ƒëi·ªÅu h√†nh Linux l√† ai?", a: ["Linus Torvalds", "Bill Gates", "Steve Jobs", "Mark Zuckerberg"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Giao th·ª©c b·∫£o m·∫≠t ƒë∆∞·ª£c s·ª≠ d·ª•ng ph·ªï bi·∫øn tr√™n tr√¨nh duy·ªát web l√†?", a: ["HTTPS", "HTTP", "FTP", "SMTP"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "ƒê∆°n v·ªã th√¥ng tin nh·ªè nh·∫•t trong m√°y t√≠nh l√† g√¨?", a: ["Bit", "Byte", "Kb", "Mb"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "AI l√† vi·∫øt t·∫Øt c·ªßa thu·∫≠t ng·ªØ n√†o?", a: ["Artificial Intelligence", "Automated Interface", "Apple Inc", "Advanced Internet"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Ng√¥n ng·ªØ l·∫≠p tr√¨nh n√†o c√≥ bi·ªÉu t∆∞·ª£ng l√† con trƒÉn?", a: ["Python", "Java", "C++", "Ruby"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Thi·∫øt b·ªã n√†o sau ƒë√¢y l√† thi·∫øt b·ªã xu·∫•t (Output device)?", a: ["M√°y in", "Chu·ªôt", "B√†n ph√≠m", "Scanner"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "M·∫°ng LAN l√† vi·∫øt t·∫Øt c·ªßa?", a: ["Local Area Network", "Large Area Network", "Long Area Network", "Local Access Network"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "C√¥ng ty n√†o s·∫£n xu·∫•t d√≤ng chip Snapdragon?", a: ["Qualcomm", "Intel", "AMD", "MediaTek"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Ph√≠m t·∫Øt ƒë·ªÉ m·ªü Task Manager tr·ª±c ti·∫øp tr√™n Windows l√†?", a: ["Ctrl + Shift + Esc", "Ctrl + Alt + Del", "Alt + F4", "Win + Tab"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "ƒê·ªãa ch·ªâ IP phi√™n b·∫£n 4 (IPv4) c√≥ bao nhi√™u bit?", a: ["32 bit", "64 bit", "128 bit", "16 bit"], c: 0 },

    // --- TI·∫æNG ANH ---
    { s: "Ti·∫øng Anh", q: "Th√†nh ng·ªØ 'Raining cats and dogs' nghƒ©a l√† g√¨?", a: ["M∆∞a r·∫•t to", "Ch√≥ m√®o c·∫Øn nhau", "Tr·ªùi n·∫Øng ƒë·∫πp", "M∆∞a ph√πn"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ n√†o ƒë·ªìng nghƒ©a v·ªõi 'Smart'?", a: ["Intelligent", "Stupid", "Slow", "Hard"], c: 0 },
    { s: "Ti·∫øng Anh", q: "D·∫°ng qu√° kh·ª© ph√¢n t·ª´ (V3) c·ªßa ƒë·ªông t·ª´ 'Eat' l√†?", a: ["Eaten", "Ate", "Eating", "Eats"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Trong c√¢u 'She plays piano', t·ª´ 'plays' l√† th√¨ g√¨?", a: ["Hi·ªán t·∫°i ƒë∆°n", "Qu√° kh·ª© ƒë∆°n", "T∆∞∆°ng lai ƒë∆°n", "Hi·ªán t·∫°i ti·∫øp di·ªÖn"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Ti·ªÅn t·ªë 'Un-' trong t·ª´ 'Unhappy' c√≥ nghƒ©a l√† g√¨?", a: ["Kh√¥ng (Not)", "R·∫•t (Very)", "L·∫°i (Re)", "Tr∆∞·ªõc (Pre)"], c: 0 },
    { s: "Ti·∫øng Anh", q: "S·ªë th·ª© t·ª± th·ª© 1 (First) vi·∫øt t·∫Øt l√† g√¨?", a: ["1st", "1nd", "1rd", "1th"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ 'Architect' nghƒ©a l√† ngh·ªÅ g√¨?", a: ["Ki·∫øn tr√∫c s∆∞", "K·ªπ s∆∞", "B√°c sƒ©", "H·ªça sƒ©"], c: 0 },
    { s: "Ti·∫øng Anh", q: "C·ª•m t·ª´ 'Piece of cake' c√≥ nghƒ©a b√≥ng l√†?", a: ["R·∫•t d·ªÖ d√†ng", "M·ªôt m·∫©u b√°nh", "R·∫•t kh√≥ khƒÉn", "Ngon mi·ªáng"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ n√†o ph√°t √¢m kh√°c v·ªõi c√°c t·ª´ c√≤n l·∫°i: Cat, Hat, Map, Car?", a: ["Car", "Cat", "Hat", "Map"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Gi·ªõi t·ª´ ƒëi c√πng v·ªõi 'Interested' l√† g√¨?", a: ["in", "on", "at", "with"], c: 0 },

    // --- TH·ªÇ THAO & NGH·ªÜ THU·∫¨T ---
    { s: "Th·ªÉ Thao", q: "M·ªôt tr·∫≠n ƒë·∫•u b√≥ng r·ªï c√≥ m·∫•y hi·ªáp ch√≠nh?", a: ["4", "2", "3", "5"], c: 0 },
    { s: "Th·ªÉ Thao", q: "K·ª∑ l·ª•c ch·∫°y 100m th·∫ø gi·ªõi hi·ªán do ai n·∫Øm gi·ªØ?", a: ["Usain Bolt", "Tyson Gay", "Yohan Blake", "Justin Gatlin"], c: 0 },
    { s: "Th·ªÉ Thao", q: "World Cup b√≥ng ƒë√° nam ƒë·∫ßu ti√™n ƒë∆∞·ª£c t·ªï ch·ª©c ·ªü ƒë√¢u?", a: ["Uruguay", "Brazil", "√ù", "Ph√°p"], c: 0 },
    { s: "Th·ªÉ Thao", q: "Trong m√¥n Tennis, ƒëi·ªÉm s·ªë '40-40' ƒë∆∞·ª£c g·ªçi l√† g√¨?", a: ["Deuce", "Tie", "Equal", "Match point"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "B·ª©c h·ªça 'Mona Lisa' l√† t√°c ph·∫©m c·ªßa ai?", a: ["Leonardo da Vinci", "Pablo Picasso", "Vincent van Gogh", "Michelangelo"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "Nh·∫°c sƒ© thi√™n t√†i Beethoven l√† ng∆∞·ªùi n∆∞·ªõc n√†o?", a: ["ƒê·ª©c", "√Åo", "Ph√°p", "Ba Lan"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "Nh·∫°c c·ª• n√†o ƒë∆∞·ª£c m·ªánh danh l√† 'Vua c·ªßa c√°c lo·∫°i nh·∫°c c·ª•'?", a: ["Piano", "Violin", "Guitar", "Tr·ªëng"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "B√†i h√°t 'Qu·ªëc ca Vi·ªát Nam' c√≥ t√™n g·ªëc l√† g√¨?", a: ["Ti·∫øn qu√¢n ca", "Di·ªát ph√°t x√≠t", "Ca ng·ª£i H·ªì Ch·ªß t·ªãch", "Thanh ni√™n l√†m theo l·ªùi B√°c"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "Ca tr√π l√† lo·∫°i h√¨nh ngh·ªá thu·∫≠t truy·ªÅn th·ªëng c·ªßa v√πng n√†o?", a: ["B·∫Øc B·ªô", "Trung B·ªô", "Nam B·ªô", "T√¢y Nguy√™n"], c: 0 },

    // --- THI√äN VƒÇN & KI·∫æN TH·ª®C CHUNG ---
    { s: "Thi√™n VƒÉn", q: "H√†nh tinh n√†o ƒë∆∞·ª£c g·ªçi l√† 'H√†nh tinh ƒê·ªè'?", a: ["Sao H·ªèa", "Sao Kim", "Sao M·ªôc", "Sao Th·ªï"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "Ng√¥i sao n√†o s√°ng nh·∫•t tr√™n b·∫ßu tr·ªùi ƒë√™m?", a: ["Sirius (Sao Thi√™n Lang)", "Polaris (Sao B·∫Øc C·ª±c)", "Betelgeuse", "Vega"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "H·ªá M·∫∑t Tr·ªùi c√≥ bao nhi√™u h√†nh tinh?", a: ["8", "9", "7", "10"], c: 0 },
    { s: "Ki·∫øn Th·ª©c", q: "ƒê∆°n v·ªã ti·ªÅn t·ªá c·ªßa Nh·∫≠t B·∫£n l√† g√¨?", a: ["Y√™n", "Won", "Nh√¢n d√¢n t·ªá", "Baht"], c: 0 },
    { s: "Ki·∫øn Th·ª©c", q: "Gi·∫£i th∆∞·ªüng Oscar l√† gi·∫£i th∆∞·ªüng c·ªßa lƒ©nh v·ª±c n√†o?", a: ["ƒêi·ªán ·∫£nh", "√Çm nh·∫°c", "VƒÉn h·ªçc", "Khoa h·ªçc"], c: 0 },
    { s: "Ki·∫øn Th·ª©c", q: "Logo c·ªßa h√£ng xe Mercedes-Benz c√≥ h√¨nh g√¨?", a: ["Ng√¥i sao 3 c√°nh", "Ng√¥i sao 4 c√°nh", "V√≤ng tr√≤n Olympic", "Con ng·ª±a"], c: 0 },
    { s: "Ki·∫øn Th·ª©c", q: "Lo·∫°i h√¨nh rubik ti√™u chu·∫©n c√≥ bao nhi√™u m·∫∑t?", a: ["6", "4", "8", "12"], c: 0 },
    { s: "Ki·∫øn Th·ª©c", q: "Bi·ªÉu t∆∞·ª£ng c·ªßa ng√†nh Y d∆∞·ª£c l√† con g√¨?", a: ["Con r·∫Øn", "Con ƒë·∫°i b√†ng", "Con r·ªìng", "Con h·ªï"], c: 0 }

];

const RAW_BOSS_QUESTIONS = [
    { q: "N∆∞·ªõc n√†o ƒë√¥ng d√¢n nh·∫•t th·∫ø gi·ªõi hi·ªán nay? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "An Do" }, 
    { q: "Tam gi√°c c√≥ 3 c·∫°nh b·∫±ng nhau g·ªçi l√† tam gi√°c g√¨? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Deu" },
    { q: "ƒê·ªânh n√∫i cao nh·∫•t Vi·ªát Nam?", a: "Fansipan" },
    { q: "Virus g√¢y ƒë·∫°i d·ªãch Covid-19 xu·∫•t hi·ªán ƒë·∫ßu ti√™n ·ªü ƒë√¢u? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Vu Han" },
    { q: "Th√°ng 2 nƒÉm nhu·∫≠n c√≥ bao nhi√™u ng√†y?", a: "29" },
    { q: "Th·ªß ƒë√¥ c·ªßa n∆∞·ªõc M·ªπ l√† g√¨ (vi·∫øt t·∫Øt)?", a: "Washington DC" },
    { q: "T√™n th·∫≠t c·ªßa B√°c H·ªì th·ªùi ni√™n thi·∫øu? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Nguyen Sinh Cung" },
    { q: "H√†nh tinh ƒë·ªè l√† t√™n g·ªçi kh√°c c·ªßa sao n√†o?", a: "Sao Hoa" },
    { q: "C√¥ng th·ª©c h√≥a h·ªçc c·ªßa Axit Sunfuric?", a: "H2SO4" },
    { q: "Ai l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë·∫∑t ch√¢n l√™n m·∫∑t trƒÉng?", a: "Neil Armstrong" },
    { q: "Vi·ªát Nam c√≥ bao nhi√™u t·ªânh th√†nh ( tr∆∞·ªõc khi x√°c nh·∫≠p ) ?", a: "63" },
    { q: "Lo√†i v·∫≠t n√†o ch·∫°y nhanh nh·∫•t tr√™n c·∫°n? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Bao" },
    { q: "M√°y t√≠nh ƒë·∫ßu ti√™n tr√™n th·∫ø gi·ªõi t√™n l√† g√¨?", a: "ENIAC" },
    { q: "Cha ƒë·∫ª c·ªßa thuy·∫øt t∆∞∆°ng ƒë·ªëi l√† ai?", a: "Albert Einstein" },
    { q: "Ng·ªçn n√∫i cao nh·∫•t Nh·∫≠t B·∫£n? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Phu Si" },
    { q: "T√°c gi·∫£ c·ªßa b·ªô truy·ªán Harry Potter?", a: "JK Rowling" },
    { q: "ƒê∆°n v·ªã nh·ªè nh·∫•t c·ªßa v·∫≠t ch·∫•t l√† g√¨? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Nguyen tu" },
    { q: "Th√†nh ph·ªë n√†o ƒë∆∞·ª£c m·ªánh danh l√† H√≤n ng·ªçc Vi·ªÖn ƒê√¥ng? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Sai Gon" },
    { q: "T√™n lo·∫°i kh√≠ d√πng ƒë·ªÉ b∆°m b√≥ng bay?", a: "Heli" },
    { q: "Con s√¥ng n√†o ch·∫£y qua th·ªß ƒë√¥ H√† N·ªôi? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Hong" },
    { q: "ƒê√†n ƒë·ªôc huy·ªÅn l√† t√™n g·ªçi kh√°c c·ªßa lo·∫°i ƒë√†n n√†o? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Dan Bau" },
    { q: "Th√†nh ph·ªë c·ªë ƒë√¥ c·ªßa Nh·∫≠t B·∫£n l√†?", a: "Tokyo" },
    { q: "Khi r∆°i t·ª± do v·∫≠t b·ªã l·ªách v·ªÅ ph∆∞∆°ng n√†o? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Dong" },
    { q: "S·ªë electron t·ªëi ƒëa c√≥ th·ªÉ ch·ª©a trong l·ªõp p l√†?", a: "6" },
    { q: "NƒÉm Ch√¢u Phi l√† nƒÉm n√†o?", a: "1960" },
    { q: "T·ª´ 1 ƒë·∫øn 150 c√≥ bao nhi√™u ch·ªØ s·ªë 0?", a: "16" },
    { q: "Corren ph√°t hi·ªán di truy·ªÅn qua t·∫ø b√†o ch·∫•t v√†o nƒÉm n√†o?", a: "1961" },
    { q: "What letter is a questions?", a: "Y" },
    { q: "Vua cho l·∫≠p VƒÉn Mi·∫øu ·ªü ThƒÉng Long nƒÉm 1070 l√†? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Ly Thanh Tong" },
    { q: "N∆∞·ªõc n√†o gi√†nh chi·∫øn th·∫Øng trong cu·ªôc thi Miss Earth nƒÉm 2018? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Viet Nam" },
    { q: "Who is the Queen of Pop?" ,  a: "Madonna" },
    { q: "H√†nh tinh quay nhanh nh·∫•t trong H·ªá m·∫∑t tr·ªùi l√†? ( ƒê√°p √°n kh√¥ng d·∫•u )", a: "Sao Moc" }
];

let questionDeck = [];
let bossDeck = [];
function refreshDeck() { questionDeck = [...RAW_QUESTIONS]; }
function getUniqueQuestion() {
    if (questionDeck.length === 0) refreshDeck();
    const index = Math.floor(Math.random() * questionDeck.length);
    return questionDeck.splice(index, 1)[0];
}

// --- GAME ENGINE ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let cw, ch;

// Config Maps
const MAP_W = 4000;
const MAP_H = 2000;

// Colors Palette (Day & Night)
// UPDATE: PATH COLOR CHANGED to Brighter Earthy Tone (#e0c097)
const C_DAY = { DIRT: '#27ae60', PATH: '#e0c097', SKY: '#87CEEB' };
const C_NIGHT = { DIRT: '#000000', PATH: '#2c3e50', SKY: '#000000' };
let C = {...C_DAY};

// Game State
let gameState = 'MENU'; 
let player = { x: 100, y: MAP_H/2, w: 32, h: 48, hp: 100, score: 0, speed: 10, face: 1, ammo: 15 };
let camera = { x: 0, y: 0 };
let bullets = [];
let monsters = [];
let trees = [];
let rocks = [];
let flowers = []; 
let ponds = [];
let stars = [];
let meteors = [];
let pathPoints = [];
let floatTexts = []; 
let bossActive = false; 

let ambushTime = 0;
let isDragging = false;
let dragStart = {x:0, y:0};
let camOffset = {x:0, y:0};

function init() {
    resize();
    window.addEventListener('resize', resize);
    generateMap();
    setupControls();
    refreshDeck();
    requestAnimationFrame(gameLoop);
}

function resize() {
    cw = canvas.width = window.innerWidth;
    ch = canvas.height = window.innerHeight;
}

function generateMap() {
    pathPoints = [];
    let steps = 400;
    for(let i=0; i<=steps; i++) {
        let t = i / steps;
        let x = t * MAP_W;
        let y = (MAP_H/2) + Math.sin(t * 12) * 350 + Math.sin(t * 30) * 120;
        pathPoints.push({x, y});
    }

    ponds = [];
    for(let i=0; i<15; i++) {
        let x = Math.random() * MAP_W;
        let y = Math.random() * MAP_H;
        let pathY = getPathY(x);
        if (Math.abs(y - pathY) > 150) {
            ponds.push({x, y, r: 60 + Math.random()*80});
        }
    }

    trees = [];
    rocks = [];
    flowers = []; 
    
    for(let i=0; i<1200; i++) { 
        let x = Math.random() * MAP_W;
        let y = Math.random() * MAP_H;
        let pathY = getPathY(x);
        let inPond = ponds.some(p => Math.hypot(x-p.x, y-p.y) < p.r);
        
        if (Math.abs(y - pathY) > 120 && !inPond) {
            let rand = Math.random();
            if (rand < 0.1) rocks.push({x, y});
            else if (rand < 0.3) trees.push({x, y, scale: 0.8 + Math.random() * 0.6});
            else flowers.push({x, y, type: Math.floor(Math.random()*5)}); 
        }
    }

    monsters = [];
    for(let i=0; i<30; i++) spawnMonster();

    stars = [];
    for(let i=0; i<300; i++) {
        stars.push({x: Math.random()*cw, y: Math.random()*ch, s: Math.random()*2});
    }
}

function getPathY(x) {
    let step = MAP_W / 400;
    let idx = Math.floor(x / step);
    if(idx < 0) idx = 0;
    if(idx >= pathPoints.length) idx = pathPoints.length-1;
    return pathPoints[idx].y;
}

function spawnMonster() {
    if (bossActive) return; 
    // EXPANDED TO 8 TYPES (0-7)
    let type = Math.floor(Math.random() * 8); 
    
    let mx = 600 + Math.random() * (MAP_W - 800);
    let my = getPathY(mx) + (Math.random()-0.5) * 600;
    if(my < 50) my = 50; if(my > MAP_H-50) my = MAP_H-50;

    let w = 32, h = 32;
    // New types
    if (type === 0) { w = 24; h = 24; } // Bee
    if (type === 1) { w = 40; h = 28; } // Fox
    if (type === 2) { w = 36; h = 20; } // Axolotl
    if (type === 3) { w = 48; h = 56; } // Wither
    // Old types (Imported)
    if (type === 4) { w = 32; h = 48; } // Zombie
    if (type === 5) { w = 32; h = 48; } // Skeleton
    if (type === 6) { w = 32; h = 44; } // Creeper
    if (type === 7) { w = 32; h = 56; } // Enderman

    monsters.push({
        x: mx, y: my, w: w, h: h, 
        type: type,
        speed: (type===1 ? 2.5 : 1.5) + Math.random() * 0.5,
        timer: 0,
        dir: {x:0, y:0}
    });
}

function spawnMeteor() {
    if(!bossActive) return;
    meteors.push({
        x: Math.random() * cw + cw, 
        y: Math.random() * ch/2,
        vx: -15 - Math.random()*10,
        vy: 5 + Math.random()*5,
        len: 50 + Math.random()*100
    });
}

function setupControls() {
    window.addEventListener('keydown', e => {
        if(gameState === 'PLAY') {
            if(e.code === 'ArrowUp') player.dy = -1;
            if(e.code === 'ArrowDown') player.dy = 1;
            if(e.code === 'ArrowLeft') { player.dx = -1; player.face = -1; }
            if(e.code === 'ArrowRight') { player.dx = 1; player.face = 1; }
            if(e.code === 'Space') fire();
        }
    });
    window.addEventListener('keyup', e => {
        if(e.code === 'ArrowUp' || e.code === 'ArrowDown') player.dy = 0;
        if(e.code === 'ArrowLeft' || e.code === 'ArrowRight') player.dx = 0;
    });

    const bindTouch = (cls, cb) => {
        const el = document.querySelector(cls);
        if(el) {
            el.addEventListener('touchstart', (e) => { e.preventDefault(); cb(true); });
            el.addEventListener('touchend', (e) => { e.preventDefault(); cb(false); });
        }
    };
    bindTouch('.d-up', (p) => player.dy = p ? -1 : 0);
    bindTouch('.d-down', (p) => player.dy = p ? 1 : 0);
    bindTouch('.d-left', (p) => { if(p) {player.dx=-1; player.face=-1} else player.dx=0; });
    bindTouch('.d-right', (p) => { if(p) {player.dx=1; player.face=1} else player.dx=0; });
    
    const btnFire = document.getElementById('btn-fire');
    if(btnFire) {
        btnFire.addEventListener('touchstart', (e)=>{ e.preventDefault(); if(gameState==='PLAY') fire(); });
        btnFire.addEventListener('mousedown', (e)=>{ e.preventDefault(); if(gameState==='PLAY') fire(); });
    }
}

function fire() {
    if (player.ammo <= 0) {
        addFloatText(player.x, player.y - 40, "H·∫æT ƒê·∫†N!", "#fff");
        return;
    }
    player.ammo--;
    updateHUD();
    
    bullets.push({
        x: player.x + 16, y: player.y + 24,
        vx: player.face * 25, vy: 0, life: 60,
        w: 12, h: 4 
    });
}

function startGame() {
    document.getElementById('start-screen').classList.remove('active');
    gameState = 'PLAY';
    ambushTime = Date.now();
    player.hp = 100; player.score = 0; player.ammo = 15;
    bossActive = false;
    C = {...C_DAY}; 
    updateHUD();
}

function gameLoop() {
    if(gameState === 'PLAY') update();
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    let now = Date.now();

    if (!bossActive) {
        let timeLeft = Math.max(0, 10 - Math.floor((now - ambushTime)/1000));
        document.getElementById('ambush-timer').innerText = timeLeft;
        if (now - ambushTime > 10000) {
            ambushTime = now;
            triggerBattle(null, 'AMBUSH');
            return;
        }
    } else {
        document.getElementById('ambush-timer').innerText = "---";
        if(Math.random() < 0.05) spawnMeteor();
        for(let i=meteors.length-1; i>=0; i--) {
            let m = meteors[i]; m.x += m.vx; m.y += m.vy;
            if(m.y > ch || m.x < -100) meteors.splice(i,1);
        }
    }

    if (player.dx) player.x += player.dx * player.speed;
    if (player.dy) player.y += player.dy * player.speed;
    
    player.x = Math.max(0, Math.min(player.x, MAP_W - 32));
    player.y = Math.max(0, Math.min(player.y, MAP_H - 48));

    let tx = player.x - cw/2; let ty = player.y - ch/2;
    camera.x += (tx - camera.x) * 0.1;
    camera.y += (ty - camera.y) * 0.1;
    camera.x = Math.max(0, Math.min(camera.x, MAP_W - cw));
    camera.y = Math.max(0, Math.min(camera.y, MAP_H - ch));

    for (let i = bullets.length - 1; i >= 0; i--) {
        let b = bullets[i];
        b.x += b.vx; b.life--;
        if (b.life <= 0) { bullets.splice(i, 1); continue; }

        for (let j = monsters.length - 1; j >= 0; j--) {
            let m = monsters[j];
            if (b.x < m.x + m.w && b.x + b.w > m.x && b.y < m.y + m.h && b.y + b.h > m.y) {
                spawnExplosion(m.x + m.w/2, m.y + m.h/2);
                addFloatText(m.x, m.y, "+1 KILL");
                monsters.splice(j, 1);
                bullets.splice(i, 1);
                player.score++;
                
                if (player.score >= 30 && !bossActive) {
                    activateBossMode();
                } else if (!bossActive) {
                    spawnMonster(); 
                }
                updateHUD();
                break; 
            }
        }
    }

    for (let m of monsters) {
        let dist = Math.hypot(player.x - m.x, player.y - m.y);
        
        // Float logic for Bee(0), Wither(3)
        if (m.type === 0 || m.type === 3) {
            m.y += Math.sin(Date.now()/200)*0.5;
        }

        if (dist < 350) { 
            let angle = Math.atan2(player.y - m.y, player.x - m.x);
            m.x += Math.cos(angle) * m.speed * 1.5; 
            m.y += Math.sin(angle) * m.speed * 1.5;
        } else { 
            if (now > m.timer) {
                m.dir = {x: Math.random()-0.5, y: Math.random()-0.5};
                m.timer = now + 1000 + Math.random()*2000;
            }
            m.x += m.dir.x * m.speed;
            m.y += m.dir.y * m.speed;
        }

        if (player.x > m.x) m.face = 1; else m.face = -1;

        if (rectCollide(player, m)) {
            triggerBattle(m, 'DEFEND');
            return;
        }
    }

    if (player.x > MAP_W - 400) {
        if (!bossActive) {
            player.x = MAP_W - 420;
            showToast("C·∫¶N 30 KILLS ƒê·ªÇ G·∫∂P BOSS!");
        } else {
            startBossFight();
        }
    }

    updateParticles();
    updateFloatTexts();
}

function activateBossMode() {
    bossActive = true;
    monsters = []; 
    C = {...C_NIGHT};
    showToast("TH·ªúI KH·∫ÆC ƒê√É ƒê·∫æN, R·ªíNG ENDER GI√ÅNG L√ÇM!");
    for(let i=0; i<50; i++) spawnExplosion(camera.x + cw/2, camera.y + ch/2, 50);
}

function updateHUD() {
    document.getElementById('score').innerText = player.score;
    document.getElementById('hp-text').innerText = player.hp;
    document.getElementById('hp-bar').style.width = player.hp + '%';
    document.getElementById('ammo-val').innerText = player.ammo;
}

function showToast(msg) {
    let t = document.getElementById('toast-msg');
    t.innerText = msg;
    t.classList.add('show');
    setTimeout(()=>t.classList.remove('show'), 3000);
}

function rectCollide(r1, r2) {
    return (r1.x < r2.x + r2.w && r1.x + r1.w > r2.x &&
            r1.y < r2.y + r2.h && r1.y + r1.h > r2.y);
}

let currentEnemy = null;
let bossStage = 0;
let bossTimer = null;

function triggerBattle(enemy, mode) {
    gameState = 'BATTLE';
    currentEnemy = enemy;
    
    if(mode === 'AMBUSH') {
        document.getElementById('ambush-overlay').style.display = 'flex';
        setTimeout(() => document.getElementById('ambush-overlay').style.display = 'none', 1500);
    }

    const modal = document.getElementById('battle-modal');
    document.getElementById('battle-title').innerText = mode === 'AMBUSH' ? "PH·ª§C K√çCH B·∫§T NG·ªú!" : "B·ªä T·∫§N C√îNG!";
    modal.classList.add('active');
    
    let qData = getUniqueQuestion();
    document.getElementById('battle-question').innerHTML = `<span class="subject-tag">${qData.s}</span><br>${qData.q}`;
    
    const optBox = document.getElementById('battle-options');
    optBox.innerHTML = '';
    
    let answers = qData.a.map((val, idx) => ({val, idx}));
    answers.sort(() => Math.random() - 0.5);

    answers.forEach(ans => {
        let btn = document.createElement('button');
        btn.className = 'ans-btn';
        btn.innerText = ans.val;
        btn.onclick = () => resolveBattle(ans.idx === qData.c, mode);
        optBox.appendChild(btn);
    });
}

function resolveBattle(correct, mode) {
    document.getElementById('battle-modal').classList.remove('active');
    
    if (correct) {
        player.score++;
        addFloatText(player.x, player.y - 40, "ƒê√öNG R·ªíI!", "#f1c40f");

        if (currentEnemy && mode !== 'AMBUSH') {
            let idx = monsters.indexOf(currentEnemy);
            if (idx > -1) {
                spawnExplosion(currentEnemy.x, currentEnemy.y);
                monsters.splice(idx, 1);
                
                if (player.score >= 30 && !bossActive) activateBossMode();
                else if (!bossActive) spawnMonster(); 
            }
        }
        
        if(player.hp < 100) player.hp = Math.min(100, player.hp + 5);
        updateHUD();

    } else {
        player.hp -= 15;
        addFloatText(player.x, player.y - 20, "-15 HP", "red");
        if (currentEnemy) currentEnemy.x += (currentEnemy.x > player.x ? 100 : -100);
        updateHUD();
        if(player.hp <= 0) endGame(false);
    }
    
    gameState = 'PLAY';
    ambushTime = Date.now();
}

function startBossFight() {
    gameState = 'BOSS';
    bossStage = 0;
    bossDeck = [...RAW_BOSS_QUESTIONS].sort(() => 0.5 - Math.random()).slice(0, 8);
    
    document.getElementById('boss-modal').classList.add('active');
    loadBossQuestion();
}

function loadBossQuestion() {
    if (bossStage >= 8) { endGame(true); return; }

    let q = bossDeck[bossStage];
    document.getElementById('boss-question').innerText = q.q;
    document.getElementById('boss-input').value = '';
    document.getElementById('boss-progress').innerText = (bossStage + 1);
    document.getElementById('boss-input').focus();

    let time = 30;
    document.getElementById('boss-timer-val').innerText = time;
    
    if (bossTimer) clearInterval(bossTimer);
    bossTimer = setInterval(() => {
        time--;
        document.getElementById('boss-timer-val').innerText = time;
        if (time <= 0) { clearInterval(bossTimer); endGame(false); }
    }, 1000);
}

function checkBossAnswer() {
    let input = document.getElementById('boss-input').value.trim().toLowerCase();
    input = input.normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/ƒë/g, "d").replace(/ƒê/g, "D");
    let correct = bossDeck[bossStage].a.toLowerCase();

    if (input === correct || input.includes(correct)) {
        bossStage++;
        spawnExplosion(player.x + 200, player.y, 40); 
        loadBossQuestion();
    } else {
        player.hp -= 20;
        document.getElementById('boss-input').style.borderColor = "red";
        setTimeout(() => document.getElementById('boss-input').style.borderColor = "#9b59b6", 500);
        if(player.hp <= 0) { clearInterval(bossTimer); endGame(false); }
        updateHUD();
    }
}

function endGame(win) {
    gameState = 'OVER';
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    document.getElementById('end-screen').classList.add('active');
    
    let title = document.getElementById('end-title');
    let msg = document.getElementById('end-msg');
    
    if (win) {
        title.innerHTML = "CHI·∫æN TH·∫ÆNG HUY HO√ÄNG!";
        title.style.color = "#f1c40f";
        msg.innerHTML = "B·∫°n ƒë√£ ti√™u di·ªát R·ªíNG ENDER v√† b·∫£o v·ªá th·∫ø gi·ªõi!<br>üèÜ K·ª∑ l·ª•c: " + player.score + " Kills";
        setInterval(() => spawnExplosion(Math.random()*cw, Math.random()*ch, 20), 200);
    } else {
        title.innerText = "GAME OVER";
        title.style.color = "#e74c3c";
        msg.innerText = "R·ªíNG ENDER ƒë√£ thi√™u r·ª•i t·∫•t c·∫£...";
    }
    
    // AUTO RELOAD ADDED HERE
    setTimeout(() => {
        location.reload();
    }, 4000);
}

// --- RENDER ---
function draw() {
    let drawCamX = camera.x - camOffset.x;
    let drawCamY = camera.y - camOffset.y;

    ctx.fillStyle = C.DIRT;
    ctx.fillRect(0, 0, cw, ch);

    if(bossActive) {
        ctx.fillStyle = "#fff";
        for(let s of stars) {
            ctx.globalAlpha = Math.random();
            ctx.fillRect(s.x, s.y, s.s, s.s);
        }
        ctx.globalAlpha = 1;

        ctx.fillStyle = "#f1c40f";
        for(let m of meteors) {
            ctx.beginPath();
            let grad = ctx.createLinearGradient(m.x, m.y, m.x - m.len, m.y - m.vy*2);
            grad.addColorStop(0, "rgba(255,255,255,1)");
            grad.addColorStop(1, "rgba(255,255,255,0)");
            ctx.strokeStyle = grad; ctx.lineWidth = 2;
            ctx.moveTo(m.x, m.y); ctx.lineTo(m.x + m.vx*5, m.y + m.vy*5);
            ctx.stroke();
        }
    }
    
    ctx.save();
    ctx.translate(-drawCamX, -drawCamY);

    if(!bossActive) {
        ctx.fillStyle = '#3498db';
        for(let p of ponds) {
            if (p.x + p.r > drawCamX && p.x - p.r < drawCamX + cw) {
                ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
            }
        }
    }
    
    // Draw Path
    ctx.lineCap = 'butt'; ctx.lineJoin = 'round';
    ctx.beginPath();
    pathPoints.forEach((p, i) => i==0 ? ctx.moveTo(p.x, p.y) : ctx.lineTo(p.x, p.y));
    ctx.lineWidth = 150; ctx.strokeStyle = C.PATH; ctx.stroke();

    // Sort Objects
    let objects = [...trees, ...rocks, ...flowers, ...monsters, player];
    objects.sort((a,b) => (a.y+ (a.h||0)) - (b.y+ (b.h||0)));

    for(let o of objects) {
        if (o === player) drawPlayer(o);
        else if (o.type !== undefined && o.w) drawMonsterSprite(o); 
        else if (o.type !== undefined) drawFlower(o); 
        else if (o.scale) drawTree(o);
        else drawRock(o);
    }

    ctx.fillStyle = '#f1c40f';
    for(let b of bullets) ctx.fillRect(b.x, b.y, b.w, b.h);

    if (bossActive) {
        drawEnderDragon(MAP_W - 250, MAP_H/2);
    }

    drawParticles();
    drawFloatTexts();
    ctx.restore();
}

function drawPlayer(p) {
    let x = Math.floor(p.x), y = Math.floor(p.y);
    let walk = (gameState==='PLAY' && (p.dx||p.dy)) ? Math.sin(Date.now()/80)*3 : 0;
    
    ctx.fillStyle = '#483D8B'; ctx.fillRect(x+8, y+30, 6, 14+walk); ctx.fillRect(x+18, y+30, 6, 14-walk); 
    ctx.fillStyle = '#2F4F4F'; ctx.fillRect(x+8, y+42+walk, 6, 2); ctx.fillRect(x+18, y+42-walk, 6, 2);
    ctx.fillStyle = '#00BFFF'; ctx.fillRect(x+4, y+14, 24, 18);
    ctx.fillStyle = '#00BFFF'; ctx.fillRect(x-2, y+14+walk, 6, 6); ctx.fillRect(x+28, y+14-walk, 6, 6);
    ctx.fillStyle = '#ffccaa'; ctx.fillRect(x-2, y+20+walk, 6, 10); ctx.fillRect(x+28, y+20-walk, 6, 10);
    ctx.fillStyle = '#ffccaa'; ctx.fillRect(x+4, y-4, 24, 20); 
    ctx.fillStyle = '#4a3020'; ctx.fillRect(x+4, y-8, 24, 8); ctx.fillRect(x+2, y-4, 4, 10); ctx.fillRect(x+26, y-4, 4, 10); 
    ctx.fillStyle = '#fff'; ctx.fillRect(x+8, y+2, 4, 4); ctx.fillRect(x+20, y+2, 4, 4); 
    ctx.fillStyle = '#3a2010'; ctx.fillRect(x+10, y+2, 2, 4); ctx.fillRect(x+20, y+2, 2, 4); 
    ctx.fillStyle = '#6d4c41'; ctx.fillRect(x+12, y+10, 8, 2); 

    ctx.fillStyle = '#95a5a6';
    if(p.face === 1) { ctx.fillRect(x+20, y+20, 18, 6); ctx.fillStyle='#000'; ctx.fillRect(x+38, y+20, 4, 6); }
    else { ctx.fillRect(x-6, y+20, 18, 6); ctx.fillStyle='#000'; ctx.fillRect(x-10, y+20, 4, 6); }
}

function drawMonsterSprite(m) {
    let x = Math.floor(m.x), y = Math.floor(m.y);
    let h = Math.abs(Math.sin(Date.now()/200))*3;
    
    // Type 0: BEE
    if (m.type === 0) { 
        ctx.fillStyle = '#f1c40f'; ctx.fillRect(x, y, 24, 24);
        ctx.fillStyle = '#000'; 
        ctx.fillRect(x+4, y, 4, 24); ctx.fillRect(x+16, y, 4, 24); 
        ctx.fillStyle = '#333'; ctx.fillRect(x+2, y+4, 4, 4); ctx.fillRect(x+18, y+4, 4, 4); 
        ctx.fillStyle = 'rgba(255,255,255,0.7)';
        ctx.fillRect(x-6, y-6, 8, 12); ctx.fillRect(x+22, y-6, 8, 12);
    } 
    // Type 1: FOX
    else if (m.type === 1) { 
        ctx.fillStyle = '#e67e22'; 
        ctx.fillRect(x, y+8, 40, 20); 
        ctx.fillRect(x+30, y-4, 16, 16); 
        ctx.fillStyle = '#fff'; 
        ctx.fillRect(x-4, y+12, 8, 8); 
        ctx.fillRect(x+42, y+6, 4, 6); 
        ctx.fillStyle = '#d35400';
        ctx.fillRect(x+4, y+28-h, 4, 8); ctx.fillRect(x+28, y+28+h, 4, 8);
        ctx.fillStyle = '#333'; ctx.fillRect(x+32, y-8, 4, 4); ctx.fillRect(x+40, y-8, 4, 4);
    }
    // Type 2: AXOLOTL
    else if (m.type === 2) { 
        ctx.fillStyle = '#f8a5c2'; 
        ctx.fillRect(x, y+6, 36, 14); 
        ctx.fillRect(x+24, y, 16, 16); 
        ctx.fillStyle = '#e66767';
        ctx.fillRect(x+36, y-2, 4, 6); ctx.fillRect(x+22, y-2, 4, 6);
        ctx.fillStyle = '#000'; ctx.fillRect(x+28, y+4, 2, 2); ctx.fillRect(x+36, y+4, 2, 2);
        ctx.fillStyle = '#f8a5c2'; ctx.fillRect(x-6, y+10, 8, 6);
    }
    // Type 3: WITHER
    else if (m.type === 3) { 
        ctx.fillStyle = '#2d3436'; 
        ctx.fillRect(x+16, y, 16, 40); 
        ctx.fillRect(x, y, 48, 12); 
        ctx.fillStyle = '#000';
        ctx.fillRect(x+12, y-12, 24, 24); 
        ctx.fillRect(x-8, y-4, 16, 16); 
        ctx.fillRect(x+40, y-4, 16, 16); 
        ctx.fillStyle = '#fff';
        ctx.fillRect(x+16, y-4, 4, 4); ctx.fillRect(x+28, y-4, 4, 4);
        ctx.fillRect(x-4, y, 2, 2); ctx.fillRect(x+4, y, 2, 2);
        ctx.fillRect(x+44, y, 2, 2); ctx.fillRect(x+52, y, 2, 2);
    }
    // IMPORTED MONSTERS FROM MAU.HTML
    // Type 4: ZOMBIE
    else if (m.type === 4) {
        ctx.fillStyle = '#228B22'; ctx.fillRect(x+4, y-4-h, 24, 20); // Green Head
        ctx.fillStyle = '#00AAAA'; ctx.fillRect(x+4, y+16-h, 24, 18); // Cyan Shirt
        ctx.fillStyle = '#483D8B'; ctx.fillRect(x+8, y+34-h, 6, 14); ctx.fillRect(x+18, y+34-h, 6, 14); // Indigo Pants
        ctx.fillStyle = '#228B22'; ctx.fillRect(x-2, y+16-h, 6, 20); ctx.fillRect(x+28, y+16-h, 6, 20); // Green Arms
        ctx.fillStyle = '#000'; ctx.fillRect(x+8, y+2-h, 6, 4); ctx.fillRect(x+18, y+2-h, 6, 4); // Eyes
    }
    // Type 5: SKELETON
    else if (m.type === 5) {
        ctx.fillStyle = '#E0E0E0'; ctx.fillRect(x+6, y-4-h, 20, 18); // Head
        ctx.fillRect(x+12, y+14-h, 8, 16); // Spine
        ctx.fillRect(x+6, y+16-h, 20, 2); ctx.fillRect(x+6, y+20-h, 20, 2); // Ribs
        ctx.fillRect(x+8, y+30-h, 4, 18); ctx.fillRect(x+20, y+30-h, 4, 18); // Legs
        ctx.fillStyle = '#404040'; ctx.fillRect(x+8, y+2-h, 4, 4); ctx.fillRect(x+20, y+2-h, 4, 4); // Eyes
        ctx.strokeStyle = '#8B4513'; ctx.lineWidth=2; 
        ctx.beginPath(); ctx.arc(x+2, y+20-h, 14, -Math.PI/2, Math.PI/2); ctx.stroke();
    }
    // Type 6: CREEPER
    else if (m.type === 6) {
        ctx.fillStyle = '#32CD32'; ctx.fillRect(x+4, y-4-h, 24, 24); // Head
        ctx.fillStyle = '#228B22'; ctx.fillRect(x+8, y+20-h, 16, 20); // Body
        ctx.fillStyle = '#006400'; ctx.fillRect(x+4, y+40-h, 6, 8); ctx.fillRect(x+22, y+40-h, 6, 8); // Feet
        ctx.fillStyle = '#000';
        ctx.fillRect(x+8, y+4-h, 6, 6); ctx.fillRect(x+18, y+4-h, 6, 6); // Eyes
        ctx.fillRect(x+13, y+12-h, 6, 4); ctx.fillRect(x+10, y+16-h, 12, 4); ctx.fillRect(x+10, y+18-h, 4, 6); ctx.fillRect(x+18, y+18-h, 4, 6); 
    }
    // Type 7: ENDERMAN
    else if (m.type === 7) {
        ctx.fillStyle = '#050505'; 
        ctx.fillRect(x+6, y-14-h, 20, 20); // Head
        ctx.fillRect(x+10, y+6-h, 12, 24); // Body
        ctx.fillRect(x+10, y+30-h, 4, 26); ctx.fillRect(x+18, y+30-h, 4, 26); // Legs
        ctx.fillRect(x+4, y+8-h, 4, 30); ctx.fillRect(x+24, y+8-h, 4, 30); // Arms
        ctx.fillStyle = '#d000ff'; ctx.fillRect(x+6, y-6-h, 6, 3); ctx.fillRect(x+20, y-6-h, 6, 3); // Eyes
    }
    
    // HP bar mini
    ctx.fillStyle = 'red'; ctx.fillRect(x, y-15, m.w, 3);
}

function drawEnderDragon(bx, by) {
    let float = Math.sin(Date.now()/500)*20;
    
    // Pillars
    ctx.fillStyle = '#3a0b0b'; 
    ctx.fillRect(bx+40, by+100, 60, 200);
    ctx.fillStyle = '#f1c40f'; ctx.fillRect(bx+50, by+60+float, 40, 40); 
    ctx.fillStyle = 'rgba(255,200,0,0.5)'; ctx.fillRect(bx+50, by+60+float, 40, 40); 

    let hx = bx, hy = by + float;
    
    // --- ADDED DRAGON BODY (INVERSE KINEMATICS SIMULATION) ---
    ctx.fillStyle = '#c0392b'; // Body Red
    for(let i=10; i>0; i--) {
        // Create snake-like movement behind head
        let bodyX = hx + i * 40 + Math.sin(Date.now()/300 + i)*20; 
        let bodyY = hy + Math.sin(Date.now()/400 + i)*30;
        
        ctx.fillRect(bodyX, bodyY, 60, 50); // Body Segment
        
        // Spines on back
        ctx.fillStyle = '#111';
        ctx.fillRect(bodyX+20, bodyY-10, 20, 10);
        
        ctx.fillStyle = '#c0392b'; // Reset color
    }
    // ---------------------------------------------------------

    // HEAD
    ctx.fillStyle = '#c0392b'; ctx.fillRect(hx-80, hy-60, 100, 80); 
    ctx.fillStyle = '#a93226'; ctx.fillRect(hx-140, hy-30, 60, 50);
    
    ctx.fillStyle = '#f1c40f'; 
    ctx.fillRect(hx-70, hy-40, 25, 12);
    ctx.shadowBlur = 10; ctx.shadowColor = '#f39c12';
    ctx.fillRect(hx-120, hy-40, 10, 10); 
    ctx.shadowBlur = 0;
    
    ctx.fillStyle = '#111';
    ctx.fillRect(hx-20, hy-80, 20, 30);
    ctx.fillRect(hx+10, hy-70, 20, 20);

    if(Math.random() > 0.5) {
        particles.push({x: hx-140, y: hy+10, vx: -5-Math.random()*5, vy: (Math.random()-0.5)*2, l: 0.8, c: '#e67e22'});
    }
    
    ctx.fillStyle = '#e74c3c'; ctx.font = "40px VT323"; 
    ctx.fillText("RED DRAGON", hx-100, hy-100);
}

function drawTree(o) {
    if(bossActive) return; 
    let w = 20 * o.scale, h = 60 * o.scale;
    let lx = 60 * o.scale, ly = 40 * o.scale;
    ctx.fillStyle = '#5d4037'; ctx.fillRect(o.x+w/2, o.y-h/2, w, h); 
    ctx.fillStyle = '#2ecc71'; 
    ctx.fillRect(o.x+w/2 - lx/2 + w/2, o.y-h/2 - ly, lx, ly);
    ctx.fillRect(o.x+w/2 - lx/3 + w/2, o.y-h/2 - ly - 20, lx*0.7, 20);
}

function drawRock(o) {
    if(bossActive) return; 
    ctx.fillStyle = '#7f8c8d'; ctx.fillRect(o.x, o.y, 30, 20);
    ctx.fillStyle = '#95a5a6'; ctx.fillRect(o.x+5, o.y+5, 10, 5);
}

function drawFlower(o) {
    if(bossActive) return; 
    
    let x = o.x, y = o.y;
    ctx.fillStyle = '#2ecc71'; ctx.fillRect(x+4, y+10, 2, 10); 
    
    if (o.type === 0) { 
        ctx.fillStyle = '#c0392b'; ctx.fillRect(x, y+2, 10, 8); 
        ctx.fillStyle = '#e74c3c'; ctx.fillRect(x+2, y+4, 6, 4);
        ctx.fillStyle = '#000'; ctx.fillRect(x+4, y+6, 2, 2);
    } 
    else if (o.type === 1) { 
        ctx.fillStyle = '#f1c40f'; ctx.fillRect(x+1, y+2, 8, 8); 
        ctx.fillStyle = '#f39c12'; ctx.fillRect(x+3, y+4, 4, 4);
    } 
    else if (o.type === 2) { 
        ctx.fillStyle = '#3498db'; ctx.fillRect(x, y, 10, 10);
        ctx.fillStyle = '#fff'; ctx.fillRect(x+3, y+3, 4, 4);
    }
    else if (o.type === 3) { 
        ctx.fillStyle = '#9b59b6'; ctx.fillRect(x, y, 10, 10); 
        ctx.fillStyle = '#8e44ad'; ctx.fillRect(x+2, y+2, 6, 6);
    }
    else if (o.type === 4) { 
        ctx.fillStyle = '#e67e22'; ctx.fillRect(x+2, y, 6, 10);
        ctx.fillStyle = '#d35400'; ctx.fillRect(x+2, y+6, 6, 4);
    }
}

let particles = [];
function spawnExplosion(x, y, count=12) {
    for(let i=0; i<count; i++) particles.push({x, y, vx:(Math.random()-.5)*15, vy:(Math.random()-.5)*15, l:1, c:Math.random()>.5?'#f1c40f':'#e74c3c'});
}
function updateParticles() {
    for(let i=particles.length-1; i>=0; i--) {
        let p = particles[i]; p.x+=p.vx; p.y+=p.vy; p.l-=0.05;
        if(p.l<=0) particles.splice(i,1);
    }
}
function drawParticles() {
    for(let p of particles) {
        ctx.globalAlpha=p.l; ctx.fillStyle=p.c; ctx.fillRect(p.x,p.y,8,8);
    }
    ctx.globalAlpha=1;
}

function addFloatText(x, y, text, color="#fff") {
    floatTexts.push({x, y, text, color, life: 1.0});
}
function updateFloatTexts() {
    for(let i=floatTexts.length-1; i>=0; i--) {
        floatTexts[i].y -= 1.5;
        floatTexts[i].life -= 0.02;
        if(floatTexts[i].life <= 0) floatTexts.splice(i,1);
    }
}
function drawFloatTexts() {
    ctx.font = "24px VT323";
    for(let t of floatTexts) {
        ctx.globalAlpha = t.life; ctx.fillStyle = t.color; ctx.strokeStyle = "black"; ctx.lineWidth = 3;
        ctx.strokeText(t.text, t.x, t.y); ctx.fillText(t.text, t.x, t.y);
    }
    ctx.globalAlpha = 1;
}

init();

</script>
</body>
</html>
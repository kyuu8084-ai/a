<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H√†nh Tr√¨nh H·ªá M·∫∑t Tr·ªùi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --bg-color: #050505;
            --ui-bg: rgba(20, 30, 50, 0.95);
            --accent: #3498db;
            --gold: #f1c40f;
            --danger: #e74c3c;
            --success: #2ecc71;
            --text-color: #ecf0f1;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg-color);
            overflow: hidden;
            font-family: 'VT323', monospace;
            touch-action: none; 
            user-select: none;
            color: var(--text-color);
        }

        canvas { display: block; }

        /* UI */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 15px; box-sizing: border-box;
            z-index: 10;
        }

        .hud-bar {
            display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto;
            text-shadow: 2px 2px 0 #000;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--accent);
            padding: 10px 20px;
            font-size: 26px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
        }

        .mission-info {
            text-align: right;
        }
        
        .timer-box { color: var(--gold); font-size: 32px; font-weight: bold; }
        .timer-box.critical { color: var(--danger); animation: pulse 0.5s infinite; }

        /* Controls */
        .controls-area {
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-bottom: 20px; pointer-events: auto; opacity: 0.8;
        }
        .dpad { position: relative; width: 160px; height: 160px; }
        .dbtn {
            position: absolute; width: 50px; height: 50px;
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3);
            display: flex; justify-content: center; align-items: center;
            font-size: 24px; cursor: pointer; border-radius: 10px;
            color: white;
        }
        .dbtn:active { background: rgba(255,255,255,0.4); transform: scale(0.95); }
        .d-up { top: 0; left: 55px; } .d-down { bottom: 0; left: 55px; }
        .d-left { top: 55px; left: 0; } .d-right { top: 55px; right: 0; }

        .boost-btn {
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(241, 196, 15, 0.2); border: 3px solid var(--gold);
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; color: var(--gold); font-weight: bold;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.3);
        }
        .boost-btn:active { background: var(--gold); color: #000; }

        /* Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; animation: zoomIn 0.3s; }

        .dialog-box {
            background: linear-gradient(135deg, #2c3e50, #000);
            border: 4px solid var(--accent);
            width: 95%; max-width: 700px; padding: 30px;
            text-align: center; border-radius: 20px;
            box-shadow: 0 0 50px rgba(52, 152, 219, 0.5);
            position: relative;
        }

        .planet-icon { font-size: 60px; margin-bottom: 10px; display: block; animation: float 3s infinite ease-in-out; }
        
        .question-progress {
            color: #bdc3c7; font-size: 20px; margin-bottom: 10px;
            text-transform: uppercase; letter-spacing: 2px;
        }

        .question-text { font-size: 28px; margin: 20px 0; line-height: 1.4; color: #fff; min-height: 80px; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ans-btn {
            background: #34495e; border: 2px solid #7f8c8d; color: #fff;
            padding: 15px; font-family: 'VT323', monospace; font-size: 24px;
            cursor: pointer; transition: 0.2s; border-radius: 8px;
        }
        .ans-btn:hover { background: var(--accent); border-color: #fff; }
        
        .start-btn {
            background: var(--success); color: #fff; font-size: 30px;
            padding: 15px 50px; border: none; border-radius: 50px;
            cursor: pointer; font-family: 'VT323', monospace;
            animation: pulseBtn 1.5s infinite;
        }

        @keyframes zoomIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }
        @keyframes pulseBtn { 0% {transform: scale(1); box-shadow: 0 0 0 rgba(46,204,113,0.7);} 70% {transform: scale(1.05); box-shadow: 0 0 20px rgba(46,204,113,0);} }
        @keyframes float { 0%,100% {transform: translateY(0);} 50% {transform: translateY(-15px);} }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div class="ui-layer">
            <div class="hud-bar">
                <div class="stat-box">
                    ü™ê H√ÄNH TINH: <span id="conquered-count" style="color: var(--accent)">0</span>/8
                </div>
                <div class="stat-box timer-box" id="timer">05:00</div>
            </div>

            <div class="controls-area">
                <div class="dpad">
                    <div class="dbtn d-up">‚ñ≤</div>
                    <div class="dbtn d-down">‚ñº</div>
                    <div class="dbtn d-left">‚óÄ</div>
                    <div class="dbtn d-right">‚ñ∂</div>
                </div>
                <div class="boost-btn" id="btn-boost">T·ªêC ƒê·ªò</div>
            </div>
        </div>

        <div id="start-screen" class="modal active">
            <div class="dialog-box" style="border-color: var(--gold);">
                <h1 style="font-size: 70px; color: var(--gold); margin: 0;">THI√äN H√Ä TRI TH·ª®C</h1>
                <p style="font-size: 24px; color: #ccc;">Nhi·ªám v·ª•: Chinh ph·ª•c H·ªá M·∫∑t Tr·ªùi</p>
                <div style="text-align: left; background: rgba(255,255,255,0.1); padding: 20px; margin: 20px; border-radius: 10px; font-size: 20px;">
                    1. üõ∏ <b>L√°i T√†u:</b> D√πng ph√≠m m≈©i t√™n ho·∫∑c n√∫t ·∫£o ƒë·ªÉ t√¨m h√†nh tinh.<br>
                    2. ü™ê <b>Chinh Ph·ª•c:</b> ƒê·ª•ng v√†o h√†nh tinh v√† tr·∫£ l·ªùi ƒë√∫ng <b>3 c√¢u h·ªèi</b>.<br>
                    3. ‚òÄÔ∏è <b>Boss Cu·ªëi:</b> Sau khi xong 8 h√†nh tinh, M·∫∑t Tr·ªùi & M·∫∑t TrƒÉng xu·∫•t hi·ªán.<br>
                    4. üèÜ <b>Chi·∫øn Th·∫Øng:</b> Tr·∫£ l·ªùi 5 c√¢u h·ªèi ·ªü Boss ƒë·ªÉ ho√†n th√†nh.<br>
                    ‚è≥ <b>Th·ªùi Gian:</b> 5 Ph√∫t.
                </div>
                <button class="start-btn" onclick="startGame()">KH·ªûI H√ÄNH NGAY</button>
            </div>
        </div>

        <div id="quiz-modal" class="modal">
            <div class="dialog-box" id="quiz-box">
                <div class="planet-icon" id="q-icon">ü™ê</div>
                <h2 style="margin: 0; color: var(--accent);" id="q-planet-name">Sao H·ªèa</h2>
                <div class="question-progress">C√¢u h·ªèi: <span id="q-progress">1</span>/<span id="q-total">3</span></div>
                <div class="question-text" id="q-content">...</div>
                <div class="options-grid" id="q-options"></div>
            </div>
        </div>

        <div id="end-screen" class="modal">
            <div class="dialog-box">
                <h1 id="end-title" style="font-size: 60px;">TH√ÄNH C√îNG!</h1>
                <p id="end-msg" style="font-size: 28px;">B·∫°n ƒë√£ chinh ph·ª•c to√†n b·ªô H·ªá M·∫∑t Tr·ªùi!</p>
                <button class="ans-btn" style="width: 200px; background: var(--success);" onclick="location.reload()">CH∆†I L·∫†I</button>
            </div>
        </div>
    </div>

<script>
/**
 * --- DATA C√ÇU H·ªéI (100 C√ÇU ƒêA D·∫†NG) ---
 */
const QUESTION_DB = [
    // To√°n
    {s:"To√°n", q:"K·∫øt qu·∫£ c·ªßa 12 x 12 l√†?", a:["144","124","148","122"], c:0},
    {s:"To√°n", q:"S·ªë nguy√™n t·ªë nh·ªè nh·∫•t l√† s·ªë m·∫•y?", a:["2","1","3","0"], c:0},
    {s:"To√°n", q:"M·ªôt h√¨nh vu√¥ng c√≥ bao nhi√™u c·∫°nh b·∫±ng nhau?", a:["4","2","3","0"], c:0},
    {s:"To√°n", q:"T·ªïng 3 g√≥c trong m·ªôt tam gi√°c l√†?", a:["180 ƒë·ªô","360 ƒë·ªô","90 ƒë·ªô","270 ƒë·ªô"], c:0},
    {s:"To√°n", q:"CƒÉn b·∫≠c 2 c·ªßa 64 l√†?", a:["8","6","16","32"], c:0},
    {s:"To√°n", q:"Ph√¢n s·ªë 1/2 b·∫±ng s·ªë th·∫≠p ph√¢n n√†o?", a:["0.5","0.2","0.25","0.1"], c:0},
    {s:"To√°n", q:"S·ªë Pi x·∫•p x·ªâ b·∫±ng bao nhi√™u?", a:["3.14","3.15","3.12","3.16"], c:0},
    {s:"To√°n", q:"H√¨nh l·ª•c gi√°c c√≥ bao nhi√™u c·∫°nh?", a:["6","5","8","4"], c:0},
    {s:"To√°n", q:"1 gi·ªù c√≥ bao nhi√™u gi√¢y?", a:["3600","60","360","1200"], c:0},
    {s:"To√°n", q:"S·ªë n√†o chia h·∫øt cho c·∫£ 2 v√† 5?", a:["10","12","15","18"], c:0},
    {s:"To√°n", q:"Di·ªán t√≠ch h√¨nh ch·ªØ nh·∫≠t t√≠nh th·∫ø n√†o?", a:["D√†i x R·ªông","D√†i + R·ªông","(D√†i + R·ªông)x2","C·∫°nh x C·∫°nh"], c:0},
    {s:"To√°n", q:"S·ªë ch·∫µn li·ªÅn sau s·ªë 98 l√†?", a:["100","99","102","96"], c:0},

    // V·∫≠t L√Ω
    {s:"L√Ω", q:"T·ªëc ƒë·ªô √°nh s√°ng trong ch√¢n kh√¥ng l√†?", a:["300.000 km/s","340 m/s","150.000 km/s","1080 km/h"], c:0},
    {s:"L√Ω", q:"ƒê∆°n v·ªã ƒëo l·ª±c l√† g√¨?", a:["Newton (N)","Kilogam (kg)","Joule (J)","Watt (W)"], c:0},
    {s:"L√Ω", q:"N∆∞·ªõc s√¥i ·ªü bao nhi√™u ƒë·ªô C (√°p su·∫•t th∆∞·ªùng)?", a:["100","90","110","80"], c:0},
    {s:"L√Ω", q:"C√¥ng th·ª©c t√≠nh v·∫≠n t·ªëc l√†?", a:["v = s/t","v = m.a","v = s.t","v = d/t"], c:0},
    {s:"L√Ω", q:"Hi·ªán t∆∞·ª£ng c·∫ßu v·ªìng xu·∫•t hi·ªán sau khi n√†o?", a:["M∆∞a","N·∫Øng h·∫°n","B√£o tuy·∫øt","ƒê·ªông ƒë·∫•t"], c:0},
    {s:"L√Ω", q:"√Çm thanh truy·ªÅn nhanh nh·∫•t trong m√¥i tr∆∞·ªùng n√†o?", a:["R·∫Øn","L·ªèng","Kh√≠","Ch√¢n kh√¥ng"], c:0},
    {s:"L√Ω", q:"Tr√°i ƒê·∫•t quay quanh tr·ª•c c·ªßa n√≥ m·∫•t bao l√¢u?", a:["24 gi·ªù","365 ng√†y","12 gi·ªù","1 th√°ng"], c:0},
    {s:"L√Ω", q:"Ai l√† ng∆∞·ªùi t√¨m ra l·ª±c h·∫•p d·∫´n?", a:["Isaac Newton","Einstein","Edison","Galileo"], c:0},
    {s:"L√Ω", q:"Nam ch√¢m c√≥ m·∫•y c·ª±c?", a:["2","1","3","4"], c:0},
    {s:"L√Ω", q:"D·ª•ng c·ª• ƒëo nhi·ªát ƒë·ªô l√†?", a:["Nhi·ªát k·∫ø","√Åp k·∫ø","V√¥n k·∫ø","Ampe k·∫ø"], c:0},

    // H√≥a H·ªçc
    {s:"H√≥a", q:"C√¥ng th·ª©c h√≥a h·ªçc c·ªßa n∆∞·ªõc l√†?", a:["H2O","CO2","O2","NaCl"], c:0},
    {s:"H√≥a", q:"Kh√≠ n√†o duy tr√¨ s·ª± ch√°y?", a:["Oxy","Nito","Hidro","Cacbonic"], c:0},
    {s:"H√≥a", q:"K√Ω hi·ªáu h√≥a h·ªçc c·ªßa V√†ng l√†?", a:["Au","Ag","Fe","Cu"], c:0},
    {s:"H√≥a", q:"Mu·ªëi ƒÉn c√≥ v·ªã g√¨?", a:["M·∫∑n","Ng·ªçt","Chua","ƒê·∫Øng"], c:0},
    {s:"H√≥a", q:"Kh√≠ n√†o l√†m ƒë·ª•c n∆∞·ªõc v√¥i trong?", a:["CO2","O2","N2","H2"], c:0},
    {s:"H√≥a", q:"Kim lo·∫°i n√†o ·ªü th·ªÉ l·ªèng ·ªü nhi·ªát ƒë·ªô th∆∞·ªùng?", a:["Th·ªßy ng√¢n","S·∫Øt","Nh√¥m","Ch√¨"], c:0},
    {s:"H√≥a", q:"Qu·ª≥ t√≠m h√≥a g√¨ khi g·∫∑p Axit?", a:["ƒê·ªè","Xanh","V√†ng","Kh√¥ng ƒë·ªïi"], c:0},
    {s:"H√≥a", q:"Nguy√™n t·ªë ph·ªï bi·∫øn nh·∫•t trong v·ªè Tr√°i ƒê·∫•t?", a:["Oxy","S·∫Øt","Nh√¥m","Silic"], c:0},
    {s:"H√≥a", q:"Kim c∆∞∆°ng ƒë∆∞·ª£c c·∫•u t·∫°o t·ª´ nguy√™n t·ªë n√†o?", a:["Cacbon","S·∫Øt","V√†ng","ƒê√°"], c:0},
    {s:"H√≥a", q:"C√¥ng th·ª©c c·ªßa mu·ªëi ƒÉn l√†?", a:["NaCl","KCl","HCl","NaOH"], c:0},

    // Sinh H·ªçc
    {s:"Sinh", q:"ƒê·ªông v·∫≠t n√†o l√† ƒë·ªông v·∫≠t c√≥ v√∫?", a:["C√° Heo","C√° M·∫≠p","C√° S·∫•u","Chim C√°nh C·ª•t"], c:0},
    {s:"Sinh", q:"L√° c√¢y m√†u xanh l√† do ch·∫•t g√¨?", a:["Di·ªáp l·ª•c","Xenlulozo","Tinh b·ªôt","Vitamin"], c:0},
    {s:"Sinh", q:"Con ng∆∞·ªùi c√≥ bao nhi√™u ƒë√¥i nhi·ªÖm s·∫Øc th·ªÉ?", a:["23","24","46","22"], c:0},
    {s:"Sinh", q:"Tim ng∆∞·ªùi c√≥ m·∫•y ngƒÉn?", a:["4","2","3","5"], c:0},
    {s:"Sinh", q:"ƒê·ªông v·∫≠t n√†o ch·∫°y nhanh nh·∫•t tr√™n c·∫°n?", a:["B√°o Cheetah","S∆∞ t·ª≠","Ng·ª±a","ƒê√† ƒëi·ªÉu"], c:0},
    {s:"Sinh", q:"Lo√†i v·∫≠t n√†o ng·ªß ƒë·ª©ng?", a:["Ng·ª±a","Ch√≥","M√®o","Kh·ªâ"], c:0},
    {s:"Sinh", q:"C√¢y x∆∞∆°ng r·ªìng s·ªëng ·ªü ƒë√¢u?", a:["Sa m·∫°c","R·ª´ng m∆∞a","ƒê·∫ßm l·∫ßy","Bi·ªÉn"], c:0},
    {s:"Sinh", q:"Vitamin n√†o t·ªët cho m·∫Øt?", a:["Vitamin A","Vitamin C","Vitamin D","Vitamin K"], c:0},
    {s:"Sinh", q:"C√° th·ªü b·∫±ng g√¨?", a:["Mang","Ph·ªïi","Da","M≈©i"], c:0},
    {s:"Sinh", q:"Con v·∫≠t n√†o ƒë·∫ª tr·ª©ng?", a:["G√†","Ch√≥","M√®o","B√≤"], c:0},

    // L·ªãch S·ª≠
    {s:"S·ª≠", q:"Chi·∫øn th·∫Øng B·∫°ch ƒê·∫±ng nƒÉm 938 do ai l√£nh ƒë·∫°o?", a:["Ng√¥ Quy·ªÅn","Tr·∫ßn H∆∞ng ƒê·∫°o","L√Ω Th∆∞·ªùng Ki·ªát","L√™ L·ª£i"], c:0},
    {s:"S·ª≠", q:"B√°c H·ªì ƒë·ªçc Tuy√™n ng√¥n ƒë·ªôc l·∫≠p nƒÉm n√†o?", a:["1945","1954","1975","1930"], c:0},
    {s:"S·ª≠", q:"Vua H√πng d·ª±ng n∆∞·ªõc ƒë·∫∑t t√™n n∆∞·ªõc l√† g√¨?", a:["VƒÉn Lang","√Çu L·∫°c","ƒê·∫°i Vi·ªát","V·∫°n Xu√¢n"], c:0},
    {s:"S·ª≠", q:"Chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß v√†o nƒÉm n√†o?", a:["1954","1945","1972","1975"], c:0},
    {s:"S·ª≠", q:"Ai l√† ng∆∞·ªùi d·ªùi ƒë√¥ v·ªÅ ThƒÉng Long?", a:["L√Ω Th√°i T·ªï","ƒêinh Ti√™n Ho√†ng","L√™ Ho√†n","Tr·∫ßn C·∫£nh"], c:0},
    {s:"S·ª≠", q:"V·ªã vua cu·ªëi c√πng c·ªßa Vi·ªát Nam l√† ai?", a:["B·∫£o ƒê·∫°i","Kh·∫£i ƒê·ªãnh","T·ª± ƒê·ª©c","Duy T√¢n"], c:0},
    {s:"S·ª≠", q:"Hai B√† Tr∆∞ng c∆∞·ª°i con g√¨ ra tr·∫≠n?", a:["Voi","Ng·ª±a","Tr√¢u","H·ªï"], c:0},
    {s:"S·ª≠", q:"T√°c gi·∫£ B√¨nh Ng√¥ ƒê·∫°i C√°o l√† ai?", a:["Nguy·ªÖn Tr√£i","L√™ L·ª£i","Nguy·ªÖn Du","Quang Trung"], c:0},
    {s:"S·ª≠", q:"Ai l√† ng∆∞·ªùi t√¨m ra Ch√¢u M·ªπ?", a:["Columbus","Magellan","Cook","Vasco da Gama"], c:0},
    {s:"S·ª≠", q:"Th√†nh C·ªï Loa g·∫Øn v·ªõi truy·ªÅn thuy·∫øt n√†o?", a:["An D∆∞∆°ng V∆∞∆°ng","S∆°n Tinh Th·ªßy Tinh","Th√°nh Gi√≥ng","S·ª± t√≠ch Tr·∫ßu Cau"], c:0},

    // ƒê·ªãa L√≠
    {s:"ƒê·ªãa", q:"Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√†?", a:["H√† N·ªôi","TP.HCM","ƒê√† N·∫µng","Hu·∫ø"], c:0},
    {s:"ƒê·ªãa", q:"ƒê·ªânh n√∫i cao nh·∫•t th·∫ø gi·ªõi?", a:["Everest","Ph√∫ Sƒ©","Fansipan","K2"], c:0},
    {s:"ƒê·ªãa", q:"Ch√¢u l·ª•c n√†o l·ªõn nh·∫•t th·∫ø gi·ªõi?", a:["Ch√¢u √Å","Ch√¢u Phi","Ch√¢u M·ªπ","Ch√¢u √Çu"], c:0},
    {s:"ƒê·ªãa", q:"S√¥ng n√†o d√†i nh·∫•t th·∫ø gi·ªõi?", a:["S√¥ng Nile","S√¥ng Amazon","S√¥ng M√™ K√¥ng","S√¥ng H·∫±ng"], c:0},
    {s:"ƒê·ªãa", q:"N∆∞·ªõc n√†o c√≥ h√¨nh chi·∫øc ·ªßng?", a:["√ù","Ph√°p","Anh","ƒê·ª©c"], c:0},
    {s:"ƒê·ªãa", q:"Vi·ªát Nam c√≥ bao nhi√™u t·ªânh th√†nh (c≈©)?", a:["63","64","60","58"], c:0},
    {s:"ƒê·ªãa", q:"H√†nh tinh n√†o g·∫ßn M·∫∑t Tr·ªùi nh·∫•t?", a:["Sao Th·ªßy","Sao Kim","Tr√°i ƒê·∫•t","Sao H·ªèa"], c:0},
    {s:"ƒê·ªãa", q:"ƒê·∫°i d∆∞∆°ng n√†o l·ªõn nh·∫•t?", a:["Th√°i B√¨nh D∆∞∆°ng","ƒê·∫°i T√¢y D∆∞∆°ng","·∫§n ƒê·ªô D∆∞∆°ng","B·∫Øc BƒÉng D∆∞∆°ng"], c:0},
    {s:"ƒê·ªãa", q:"N∆∞·ªõc n√†o ƒë√¥ng d√¢n nh·∫•t th·∫ø gi·ªõi (2023)?", a:["·∫§n ƒê·ªô","Trung Qu·ªëc","M·ªπ","Nga"], c:0},
    {s:"ƒê·ªãa", q:"Th√†nh ph·ªë n√†o l√† H√≤n ng·ªçc Vi·ªÖn ƒê√¥ng?", a:["S√†i G√≤n","H√† N·ªôi","ƒê√† L·∫°t","Nha Trang"], c:0},

    // VƒÉn H·ªçc & Ti·∫øng Anh
    {s:"VƒÉn", q:"Truy·ªán Ki·ªÅu l√† c·ªßa ai?", a:["Nguy·ªÖn Du","Nguy·ªÖn Tr√£i","H·ªì Xu√¢n H∆∞∆°ng","Nam Cao"], c:0},
    {s:"VƒÉn", q:"Th√°nh Gi√≥ng d√πng g√¨ ƒë√°nh gi·∫∑c?", a:["Tre ng√†","S√∫ng","G∆∞∆°m","N·ªè"], c:0},
    {s:"VƒÉn", q:"Ai l√† t√°c gi·∫£ D·∫ø M√®n Phi√™u L∆∞u K√Ω?", a:["T√¥ Ho√†i","Nam Cao","V≈© Tr·ªçng Ph·ª•ng","Th·∫°ch Lam"], c:0},
    {s:"VƒÉn", q:"S·ªç D·ª´a l√† th·ªÉ lo·∫°i truy·ªán g√¨?", a:["C·ªï t√≠ch","Truy·ªÅn thuy·∫øt","Ng·ª• ng√¥n","Th·∫ßn tho·∫°i"], c:0},
    {s:"Anh", q:"'Hello' nghƒ©a l√† g√¨?", a:["Xin ch√†o","T·∫°m bi·ªát","C·∫£m ∆°n","Xin l·ªói"], c:0},
    {s:"Anh", q:"Con m√®o trong ti·∫øng Anh l√†?", a:["Cat","Dog","Bird","Fish"], c:0},
    {s:"Anh", q:"M√†u ƒë·ªè ti·∫øng Anh l√†?", a:["Red","Blue","Green","Yellow"], c:0},
    {s:"Anh", q:"'Thank you' nghƒ©a l√†?", a:["C·∫£m ∆°n","Xin ch√†o","T·∫°m bi·ªát","Xin l·ªói"], c:0},
    {s:"Anh", q:"S·ªë 10 ti·∫øng Anh l√†?", a:["Ten","One","Two","Five"], c:0},
    {s:"Anh", q:"Qu·∫£ t√°o ti·∫øng Anh l√†?", a:["Apple","Banana","Orange","Grape"], c:0},

    // T·ªïng h·ª£p kh√°c
    {s:"Kh√°c", q:"ƒê√®n giao th√¥ng c√≥ m·∫•y m√†u?", a:["3","2","4","5"], c:0},
    {s:"Kh√°c", q:"1 nƒÉm c√≥ bao nhi√™u th√°ng?", a:["12","10","11","13"], c:0},
    {s:"Kh√°c", q:"B√≥ng ƒë√° c√≥ bao nhi√™u ng∆∞·ªùi m·ªói ƒë·ªôi?", a:["11","10","7","5"], c:0},
    {s:"Kh√°c", q:"Th√°ng 2 nƒÉm nhu·∫≠n c√≥ bao nhi√™u ng√†y?", a:["29","28","30","31"], c:0},
    {s:"Kh√°c", q:"Ai ph√°t minh ra b√≥ng ƒë√®n?", a:["Edison","Einstein","Newton","Tesla"], c:0},
    {s:"Kh√°c", q:"CPU l√† b·ªô ph·∫≠n c·ªßa thi·∫øt b·ªã n√†o?", a:["M√°y t√≠nh","T·ªß l·∫°nh","M√°y gi·∫∑t","L√≤ vi s√≥ng"], c:0},
    {s:"Kh√°c", q:"M·∫°ng x√£ h·ªôi l·ªõn nh·∫•t th·∫ø gi·ªõi?", a:["Facebook","Twitter","Instagram","TikTok"], c:0},
    {s:"Kh√°c", q:"Nobita l√† nh√¢n v·∫≠t trong truy·ªán n√†o?", a:["Doraemon","Conan","Naruto","Dragon Ball"], c:0},
    {s:"Kh√°c", q:"Ch√¢u l·ª•c n√†o l·∫°nh nh·∫•t?", a:["Nam C·ª±c","B·∫Øc C·ª±c","Ch√¢u √Çu","Ch√¢u √Å"], c:0},
    {s:"Kh√°c", q:"ƒê·ªông v·∫≠t n√†o cao nh·∫•t th·∫ø gi·ªõi?", a:["H∆∞∆°u cao c·ªï","Voi","ƒê√† ƒëi·ªÉu","Kh·ªßng long"], c:0},
    {s:"Kh√°c", q:"Lo√†i hoa n√†o h∆∞·ªõng v·ªÅ m·∫∑t tr·ªùi?", a:["H∆∞·ªõng d∆∞∆°ng","Hoa h·ªìng","Hoa lan","Hoa c√∫c"], c:0},
    {s:"Kh√°c", q:"T·∫øt Nguy√™n ƒê√°n l√† t·∫øt g√¨?", a:["T·∫øt √Çm l·ªãch","T·∫øt D∆∞∆°ng l·ªãch","T·∫øt Trung thu","T·∫øt ƒêoan ng·ªç"], c:0},
    {s:"Kh√°c", q:"ƒê∆°n v·ªã ti·ªÅn t·ªá c·ªßa Vi·ªát Nam?", a:["ƒê·ªìng","ƒê√¥ la","Y√™n","Euro"], c:0},
    {s:"Kh√°c", q:"Ai l√† ng∆∞·ªùi ƒë·∫ßu ti√™n bay v√†o v≈© tr·ª•?", a:["Yuri Gagarin","Neil Armstrong","Ph·∫°m Tu√¢n","Buzz Aldrin"], c:0},
    {s:"Kh√°c", q:"Bi·ªÉu t∆∞·ª£ng c·ªßa h√≤a b√¨nh l√† con g√¨?", a:["B·ªì c√¢u","ƒê·∫°i b√†ng","C√∫ m√®o","Chim s·∫ª"], c:0}
];

// --- C·∫§U H√åNH GAME ---
const MAP_W = 2500; 
const MAP_H = 2000;
let timeLeft = 300; // 5 ph√∫t = 300 gi√¢y

// --- BI·∫æN TO√ÄN C·ª§C ---
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let cw, ch;

let gameState = 'MENU';
let player = { x: 200, y: MAP_H/2, r: 25, speed: 6, angle: 0, dx: 0, dy: 0 };
let camera = { x: 0, y: 0 };
let keys = {};

// D·ªØ li·ªáu h√†nh tinh
let planets = [];
let sun = {}; 
let moon = {};
let asteroids = [];
let stars = [];
let particles = [];

let questionQueue = []; // H√†ng ƒë·ª£i c√¢u h·ªèi cho modal
let activePlanet = null; // H√†nh tinh ƒëang t∆∞∆°ng t√°c
let questionStreak = 0; // S·ªë c√¢u ƒë√∫ng li√™n ti·∫øp hi·ªán t·∫°i
let conqueredCount = 0; // S·ªë h√†nh tinh ƒë√£ chinh ph·ª•c
let phase = 1; // 1: Planets, 2: Sun & Moon

let timerInterval;

// --- KH·ªûI T·∫†O ---
function init() {
    resize();
    window.addEventListener('resize', resize);
    setupInputs();
    requestAnimationFrame(gameLoop);
}

function resize() {
    cw = canvas.width = window.innerWidth;
    ch = canvas.height = window.innerHeight;
}

function setupInputs() {
    // Keyboard
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    // Touch Controls
    const bindTouch = (cls, code) => {
        const el = document.querySelector(cls);
        el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; });
        el.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
    };
    bindTouch('.d-up', 'ArrowUp');
    bindTouch('.d-down', 'ArrowDown');
    bindTouch('.d-left', 'ArrowLeft');
    bindTouch('.d-right', 'ArrowRight');
    
    const boostBtn = document.getElementById('btn-boost');
    boostBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['Space'] = true; });
    boostBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['Space'] = false; });
}

function generateWorld() {
    planets = [];
    const planetData = [
        {n: "Sao Th·ªßy", c: "#95a5a6", r: 40},
        {n: "Sao Kim", c: "#e67e22", r: 50},
        {n: "Tr√°i ƒê·∫•t", c: "#3498db", r: 55},
        {n: "Sao H·ªèa", c: "#c0392b", r: 45},
        {n: "Sao M·ªôc", c: "#d35400", r: 90},
        {n: "Sao Th·ªï", c: "#f1c40f", r: 80, ring: true},
        {n: "Sao T.V∆∞∆°ng", c: "#1abc9c", r: 60},
        {n: "Sao H.V∆∞∆°ng", c: "#2980b9", r: 60}
    ];

    // R·∫£i r√°c h√†nh tinh
    for(let i=0; i<8; i++) {
        let px, py, safe;
        do {
            safe = true;
            px = 200 + Math.random() * (MAP_W - 400);
            py = 200 + Math.random() * (MAP_H - 400);
            // Check distance from player start
            if(Math.hypot(px - 200, py - MAP_H/2) < 300) safe = false;
            // Check distance from other planets
            for(let p of planets) {
                if(Math.hypot(px - p.x, py - p.y) < 300) safe = false;
            }
        } while(!safe);

        planets.push({
            x: px, y: py, ...planetData[i], 
            conquered: false, req: 3, 
            angle: 0 // d√πng cho phase 2 xoay quanh boss
        });
    }

    // Boss (·∫®n l√∫c ƒë·∫ßu)
    sun = { x: MAP_W/2, y: MAP_H/2, r: 120, n: "M·∫∑t Tr·ªùi", c: "#f39c12", active: false, conquered: false, req: 5 };
    moon = { x: MAP_W/2, y: MAP_H/2, r: 60, n: "M·∫∑t TrƒÉng", c: "#bdc3c7", active: false, conquered: false, req: 5 };

    // ƒê√° bay (Asteroids)
    asteroids = [];
    for(let i=0; i<40; i++) {
        asteroids.push({
            x: Math.random()*MAP_W, y: Math.random()*MAP_H,
            r: 15 + Math.random()*25,
            dx: (Math.random()-0.5)*3, dy: (Math.random()-0.5)*3,
            rot: Math.random(), rSpeed: (Math.random()-0.5)*0.1
        });
    }

    // Sao n·ªÅn
    stars = [];
    for(let i=0; i<400; i++) {
        stars.push({x: Math.random()*MAP_W, y: Math.random()*MAP_H, s: Math.random()*3, a: Math.random()});
    }
}

function startGame() {
    document.getElementById('start-screen').classList.remove('active');
    generateWorld();
    conqueredCount = 0;
    phase = 1;
    timeLeft = 300;
    player.x = 200; player.y = MAP_H/2;
    gameState = 'PLAY';
    
    // Timer
    if(timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if(gameState === 'PLAY') {
            timeLeft--;
            updateTimerUI();
            if(timeLeft <= 0) endGame(false);
        }
    }, 1000);
    updateHUD();
}

function updateTimerUI() {
    let m = Math.floor(timeLeft / 60);
    let s = timeLeft % 60;
    let timeStr = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    const el = document.getElementById('timer');
    el.innerText = timeStr;
    if(timeLeft < 60) el.classList.add('critical');
    else el.classList.remove('critical');
}

// --- LOGIC GAME LOOP ---
function gameLoop() {
    if(gameState === 'PLAY') update();
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    // 1. Di chuy·ªÉn T·ª± Do (Direct Movement)
    let speed = keys['Space'] ? 10 : 5; // Boost
    player.dx = 0; player.dy = 0;

    if (keys['ArrowUp']) player.dy = -speed;
    if (keys['ArrowDown']) player.dy = speed;
    if (keys['ArrowLeft']) player.dx = -speed;
    if (keys['ArrowRight']) player.dx = speed;

    player.x += player.dx;
    player.y += player.dy;

    // Gi·ªõi h·∫°n b·∫£n ƒë·ªì
    player.x = Math.max(player.r, Math.min(MAP_W - player.r, player.x));
    player.y = Math.max(player.r, Math.min(MAP_H - player.r, player.y));

    // Camera b√°m theo
    camera.x += (player.x - cw/2 - camera.x) * 0.1;
    camera.y += (player.y - ch/2 - camera.y) * 0.1;
    camera.x = Math.max(0, Math.min(MAP_W - cw, camera.x));
    camera.y = Math.max(0, Math.min(MAP_H - ch, camera.y));

    // H∆∞·ªõng xoay c·ªßa t√†u (cho ƒë·∫πp)
    if (player.dx !== 0 || player.dy !== 0) {
        player.angle = Math.atan2(player.dy, player.dx);
        // T·∫°o h·∫°t ƒë·ªông c∆°
        spawnThrust();
    }

    // 2. Va ch·∫°m v·ªõi H√†nh tinh (Phase 1)
    if(phase === 1) {
        for(let p of planets) {
            if(!p.conquered && checkCollision(player, p)) {
                startQuiz(p);
                return; // D·ª´ng update ƒë·ªÉ v√†o modal
            }
        }
        if(conqueredCount >= 8) startPhase2();
    } 
    // Phase 2: Boss
    else {
        // Xoay c√°c h√†nh tinh xung quanh Sun/Moon
        let cx = MAP_W/2; let cy = MAP_H/2;
        let time = Date.now() / 1000;
        
        // Sun & Moon position update (Moon orbits Sun slightly)
        moon.x = cx + Math.cos(time) * 300;
        moon.y = cy + Math.sin(time) * 300;

        // C√°c h√†nh tinh kh√°c xoay v√≤ng tr√≤n l·ªõn
        planets.forEach((p, idx) => {
            let orbitR = 600 + idx * 50;
            let speed = 0.5 - idx * 0.02;
            p.x = cx + Math.cos(time * speed + idx) * orbitR;
            p.y = cy + Math.sin(time * speed + idx) * orbitR;
        });

        // Va ch·∫°m Boss
        if(!sun.conquered && checkCollision(player, sun)) startQuiz(sun);
        if(!moon.conquered && checkCollision(player, moon)) startQuiz(moon);

        if(sun.conquered && moon.conquered) endGame(true);
    }

    // 3. Va ch·∫°m ƒë√° (B·∫≠t l·∫°i)
    for(let a of asteroids) {
        a.x += a.dx; a.y += a.dy; a.rot += a.rSpeed;
        // Wrap around map
        if(a.x < 0) a.x = MAP_W; if(a.x > MAP_W) a.x = 0;
        if(a.y < 0) a.y = MAP_H; if(a.y > MAP_H) a.y = 0;

        if(checkCollision(player, a)) {
            // ƒê·∫©y l√πi player
            let ang = Math.atan2(player.y - a.y, player.x - a.x);
            player.x += Math.cos(ang) * 20;
            player.y += Math.sin(ang) * 20;
            spawnExplosion(player.x, player.y, 5, '#fff');
        }
    }

    // Particles
    for(let i=particles.length-1; i>=0; i--) {
        let p = particles[i]; p.x += p.vx; p.y += p.vy; p.l -= 0.05;
        if(p.l <= 0) particles.splice(i, 1);
    }
}

function checkCollision(c1, c2) {
    let dist = Math.hypot(c1.x - c2.x, c1.y - c2.y);
    return dist < c1.r + c2.r;
}

function spawnThrust() {
    let bx = player.x - Math.cos(player.angle) * 20;
    let by = player.y - Math.sin(player.angle) * 20;
    particles.push({x: bx, y: by, vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2, l: 1, c: '#f1c40f'});
}

function spawnExplosion(x, y, count, color) {
    for(let i=0; i<count; i++) {
        particles.push({x: x, y: y, vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10, l: 1, c: color});
    }
}

// --- LOGIC QUIZ ---
function startQuiz(target) {
    gameState = 'MODAL';
    activePlanet = target;
    questionStreak = 0;
    
    // L·∫•y c√¢u h·ªèi ng·∫´u nhi√™n kh√¥ng tr√πng l·∫∑p (ƒë∆°n gi·∫£n h√≥a b·∫±ng c√°ch shuffle m·ªói l·∫ßn)
    // ƒê·ªÉ ƒë·∫£m b·∫£o "kh√¥ng tr√πng l·∫∑p" tuy·ªát ƒë·ªëi trong phi√™n, ta c√≥ th·ªÉ d√πng 1 m·∫£ng ƒë√£ shuffle
    // ·ªû ƒë√¢y ta pick ng·∫´u nhi√™n t·ª´ DB l·ªõn
    questionQueue = [];
    let tempDB = [...QUESTION_DB].sort(() => 0.5 - Math.random());
    for(let i=0; i<target.req; i++) {
        questionQueue.push(tempDB[i]);
    }

    document.getElementById('quiz-modal').classList.add('active');
    document.getElementById('q-planet-name').innerText = target.n;
    // Icon
    document.getElementById('q-icon').innerText = (target.n === 'M·∫∑t Tr·ªùi') ? '‚òÄÔ∏è' : (target.n === 'M·∫∑t TrƒÉng' ? 'üåô' : 'ü™ê');
    
    showNextQuestion();
}

function showNextQuestion() {
    if(questionStreak >= activePlanet.req) {
        // Ho√†n th√†nh h√†nh tinh
        finishPlanet();
        return;
    }

    let q = questionQueue[questionStreak];
    document.getElementById('q-progress').innerText = questionStreak + 1;
    document.getElementById('q-total').innerText = activePlanet.req;
    document.getElementById('q-content').innerHTML = `<span class="subject-tag" style="font-size:16px;">${q.s}</span><br>${q.q}`;
    
    const grid = document.getElementById('q-options');
    grid.innerHTML = '';
    
    q.a.forEach((ans, idx) => {
        let btn = document.createElement('button');
        btn.className = 'ans-btn';
        btn.innerText = ans;
        btn.onclick = () => checkAnswer(idx, q.c, btn);
        grid.appendChild(btn);
    });
}

function checkAnswer(selected, correct, btn) {
    // Disable all btns
    let btns = document.querySelectorAll('.ans-btn');
    btns.forEach(b => b.disabled = true);

    if(selected === correct) {
        btn.style.background = 'var(--success)';
        questionStreak++;
        setTimeout(showNextQuestion, 800);
    } else {
        btn.style.background = 'var(--danger)';
        btns[correct].style.background = 'var(--success)'; // Show correct
        // Sai th√¨ kh√¥ng reset streak, nh∆∞ng ph·∫£i tr·∫£ l·ªùi l·∫°i c√¢u kh√°c ho·∫∑c c√¢u ƒë√≥?
        // Theo y√™u c·∫ßu: "B·∫Øt bu·ªôc tr·∫£ l·ªùi 3 c√¢u". N·∫øu sai, ta s·∫Ω thay b·∫±ng 1 c√¢u m·ªõi v√†o v·ªã tr√≠ ƒë√≥ ƒë·ªÉ ng∆∞·ªùi ch∆°i ph·∫£i tr·∫£ l·ªùi ƒë√∫ng ƒë·ªß s·ªë l∆∞·ª£ng.
        // Penalty: tr·ª´ th·ªùi gian
        timeLeft -= 10; updateTimerUI();
        
        setTimeout(() => {
            // Thay c√¢u h·ªèi hi·ªán t·∫°i b·∫±ng c√¢u m·ªõi
            let newQ = QUESTION_DB[Math.floor(Math.random() * QUESTION_DB.length)];
            questionQueue[questionStreak] = newQ;
            showNextQuestion();
        }, 1200);
    }
}

function finishPlanet() {
    document.getElementById('quiz-modal').classList.remove('active');
    gameState = 'PLAY';
    activePlanet.conquered = true;
    
    // ƒê·∫©y player ra xa ch√∫t ƒë·ªÉ ko b·ªã d√≠nh loop
    player.x += Math.cos(player.angle + Math.PI) * 100;
    player.y += Math.sin(player.angle + Math.PI) * 100;

    spawnExplosion(activePlanet.x, activePlanet.y, 50, activePlanet.c);
    
    if(phase === 1) {
        conqueredCount++;
        updateHUD();
    } else {
        // Boss conquered
        spawnExplosion(activePlanet.x, activePlanet.y, 100, '#fff');
    }
}

function startPhase2() {
    phase = 2;
    sun.active = true;
    moon.active = true;
    // Move player to safe spot
    player.x = 200; player.y = 200;
    
    // Hi·ªáu ·ª©ng "T·ªèa s√°ng"
    let overlay = document.createElement('div');
    overlay.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:999;animation: flash 2s forwards;";
    document.body.appendChild(overlay);
    setTimeout(() => overlay.remove(), 2000);
    
    // CSS animation for flash
    const style = document.createElement('style');
    style.innerHTML = `@keyframes flash { 0%{opacity:0;} 50%{opacity:1;} 100%{opacity:0;} }`;
    document.head.appendChild(style);
}

function endGame(win) {
    gameState = 'OVER';
    clearInterval(timerInterval);
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    let endScreen = document.getElementById('end-screen');
    
    if(win) {
        document.getElementById('end-title').innerText = "V√î ƒê·ªäCH V≈® TR·ª§!";
        document.getElementById('end-title').style.color = "var(--success)";
        document.getElementById('end-msg').innerText = "B·∫°n ƒë√£ chinh ph·ª•c ho√†n to√†n H·ªá M·∫∑t Tr·ªùi!";
    } else {
        document.getElementById('end-title').innerText = "TH·∫§T B·∫†I!";
        document.getElementById('end-title').style.color = "var(--danger)";
        document.getElementById('end-msg').innerText = "H·∫øt th·ªùi gian r·ªìi! H√£y th·ª≠ l·∫°i nh√©.";
    }
    endScreen.classList.add('active');
}

function updateHUD() {
    document.getElementById('conquered-count').innerText = conqueredCount;
}

// --- RENDER ---
function draw() {
    let dx = -camera.x; let dy = -camera.y;
    ctx.fillStyle = 'var(--bg-color)'; ctx.fillRect(0, 0, cw, ch);

    ctx.save();
    ctx.translate(dx, dy);

    // Sao n·ªÅn
    for(let s of stars) {
        ctx.fillStyle = '#fff'; ctx.globalAlpha = Math.random();
        ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;

    // V·∫Ω Bosses (Phase 2)
    if(phase === 2) {
        // Orbit lines
        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(MAP_W/2, MAP_H/2, 300, 0, Math.PI*2); ctx.stroke(); // Moon orbit
        
        drawBody(sun);
        drawBody(moon);
    }

    // V·∫Ω H√†nh tinh
    for(let p of planets) {
        drawBody(p);
    }

    // Asteroids
    for(let a of asteroids) {
        ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.rot);
        ctx.fillStyle = '#7f8c8d';
        ctx.beginPath(); 
        ctx.moveTo(a.r, 0);
        for(let i=1; i<7; i++) {
            let angle = i * Math.PI * 2 / 7;
            let r = a.r * (0.8 + Math.random()*0.4);
            ctx.lineTo(Math.cos(angle)*r, Math.sin(angle)*r);
        }
        ctx.closePath(); ctx.fill();
        ctx.restore();
    }

    // Particles
    for(let p of particles) {
        ctx.globalAlpha = p.l; ctx.fillStyle = p.c;
        ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;

    // Player
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.rotate(player.angle);
    // Ship Body
    ctx.fillStyle = '#ecf0f1'; ctx.beginPath(); ctx.ellipse(0, 0, 25, 12, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#3498db'; ctx.beginPath(); ctx.arc(0, -5, 8, 0, Math.PI*2); ctx.fill(); // Cockpit
    // Wings
    ctx.fillStyle = '#e74c3c'; 
    ctx.beginPath(); ctx.moveTo(-10, 10); ctx.lineTo(-20, 20); ctx.lineTo(0, 10); ctx.fill();
    ctx.beginPath(); ctx.moveTo(-10, -10); ctx.lineTo(-20, -20); ctx.lineTo(0, -10); ctx.fill();
    // Engine flame
    if(keys['ArrowUp'] || keys['ArrowDown'] || keys['ArrowLeft'] || keys['ArrowRight']) {
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath(); ctx.moveTo(-25, -5); ctx.lineTo(-40 - Math.random()*10, 0); ctx.lineTo(-25, 5); ctx.fill();
    }
    ctx.restore();

    ctx.restore();
}

function drawBody(b) {
    if(b.conquered) {
        // H√†nh tinh ƒë√£ xong th√¨ m·ªù ƒëi ho·∫∑c c√≥ d·∫•u t√≠ch
        ctx.globalAlpha = 0.5;
    }
    
    // Glow effect
    let grad = ctx.createRadialGradient(b.x, b.y, b.r*0.2, b.x, b.y, b.r);
    grad.addColorStop(0, b.c);
    grad.addColorStop(1, '#000');
    
    ctx.fillStyle = grad;
    ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();

    // V√†nh ƒëai cho sao Th·ªï
    if(b.ring) {
        ctx.strokeStyle = 'rgba(200, 200, 150, 0.6)'; ctx.lineWidth = 10;
        ctx.beginPath(); ctx.ellipse(b.x, b.y, b.r*1.6, b.r*0.4, -0.3, 0, Math.PI*2); ctx.stroke();
    }

    // T√™n
    ctx.globalAlpha = 1;
    ctx.fillStyle = '#fff'; ctx.font = '20px VT323'; ctx.textAlign = 'center';
    ctx.fillText(b.n, b.x, b.y + b.r + 25);
    
    if(b.conquered) {
        ctx.fillStyle = '#2ecc71'; ctx.font = '30px VT323';
        ctx.fillText("‚úì", b.x, b.y);
    }
}

init();

</script>
</body>
</html>
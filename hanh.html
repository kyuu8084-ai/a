<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduSpace: Solar System Realistic</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&display=swap');

        :root {
            --bg-color: #050505;
            --ui-bg: rgba(20, 30, 50, 0.95);
            --accent: #3498db;
            --gold: #f1c40f;
            --danger: #e74c3c;
            --success: #2ecc71;
            --text-color: #ecf0f1;
        }

        body {
            margin: 0; padding: 0;
            background: var(--bg-color);
            overflow: hidden;
            font-family: 'VT323', monospace;
            touch-action: none; 
            user-select: none;
            color: var(--text-color);
        }

        canvas { display: block; }

        /* UI */
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            display: flex; flex-direction: column; justify-content: space-between;
            padding: 15px; box-sizing: border-box;
            z-index: 10;
        }

        .hud-bar {
            display: flex; justify-content: space-between; align-items: flex-start;
            pointer-events: auto;
            text-shadow: 2px 2px 0 #000;
        }

        .stat-box {
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid var(--accent);
            padding: 10px 20px;
            font-size: 26px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.3);
        }
        
        .timer-box { color: var(--gold); font-size: 32px; font-weight: bold; }
        .timer-box.critical { color: var(--danger); animation: pulse 0.5s infinite; }

        /* Controls */
        .controls-area {
            display: flex; justify-content: space-between; align-items: flex-end;
            padding-bottom: 20px; pointer-events: auto; opacity: 0.8;
        }
        .dpad { position: relative; width: 160px; height: 160px; }
        .dbtn {
            position: absolute; width: 50px; height: 50px;
            background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3);
            display: flex; justify-content: center; align-items: center;
            font-size: 24px; cursor: pointer; border-radius: 10px;
            color: white;
        }
        .dbtn:active { background: rgba(255,255,255,0.4); transform: scale(0.95); }
        .d-up { top: 0; left: 55px; } .d-down { bottom: 0; left: 55px; }
        .d-left { top: 55px; left: 0; } .d-right { top: 55px; right: 0; }

        .boost-btn {
            width: 80px; height: 80px; border-radius: 50%;
            background: rgba(241, 196, 15, 0.2); border: 3px solid var(--gold);
            display: flex; justify-content: center; align-items: center;
            font-size: 20px; color: var(--gold); font-weight: bold;
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.3);
        }
        .boost-btn:active { background: var(--gold); color: #000; }

        /* Modal */
        .modal {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: none; justify-content: center; align-items: center;
        }
        .modal.active { display: flex; animation: zoomIn 0.3s; }

        .dialog-box {
            background: linear-gradient(135deg, #2c3e50, #000);
            border: 4px solid var(--accent);
            width: 95%; max-width: 700px; padding: 30px;
            text-align: center; border-radius: 20px;
            box-shadow: 0 0 50px rgba(52, 152, 219, 0.5);
            position: relative;
        }

        .planet-icon { font-size: 60px; margin-bottom: 10px; display: block; animation: float 3s infinite ease-in-out; }
        
        .question-progress {
            color: #bdc3c7; font-size: 20px; margin-bottom: 10px;
            text-transform: uppercase; letter-spacing: 2px;
        }

        .question-text { font-size: 28px; margin: 20px 0; line-height: 1.4; color: #fff; min-height: 80px; }
        
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .ans-btn {
            background: #34495e; border: 2px solid #7f8c8d; color: #fff;
            padding: 15px; font-family: 'VT323', monospace; font-size: 24px;
            cursor: pointer; transition: 0.2s; border-radius: 8px;
        }
        .ans-btn:hover { background: var(--accent); border-color: #fff; }
        
        .start-btn {
            background: var(--success); color: #fff; font-size: 30px;
            padding: 15px 50px; border: none; border-radius: 50px;
            cursor: pointer; font-family: 'VT323', monospace;
            animation: pulseBtn 1.5s infinite;
        }

        @keyframes zoomIn { from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;} }
        @keyframes pulse { 0% {opacity: 1;} 50% {opacity: 0.5;} 100% {opacity: 1;} }
        @keyframes pulseBtn { 0% {transform: scale(1); box-shadow: 0 0 0 rgba(46,204,113,0.7);} 70% {transform: scale(1.05); box-shadow: 0 0 20px rgba(46,204,113,0);} }
        @keyframes float { 0%,100% {transform: translateY(0);} 50% {transform: translateY(-15px);} }

    </style>
</head>
<body>

    <div id="game-container">
        <canvas id="gameCanvas"></canvas>

        <div class="ui-layer">
            <div class="hud-bar">
                <div class="stat-box">
                    ü™ê H√ÄNH TINH: <span id="conquered-count" style="color: var(--accent)">0</span>/8
                </div>
                <div class="stat-box timer-box" id="timer">05:00</div>
            </div>

            <div class="controls-area">
                <div class="dpad">
                    <div class="dbtn d-up">‚ñ≤</div>
                    <div class="dbtn d-down">‚ñº</div>
                    <div class="dbtn d-left">‚óÄ</div>
                    <div class="dbtn d-right">‚ñ∂</div>
                </div>
                <div class="boost-btn" id="btn-boost">T·ªêC ƒê·ªò</div>
            </div>
        </div>

        <div id="start-screen" class="modal active">
            <div class="dialog-box" style="border-color: var(--gold);">
                <h1 style="font-size: 70px; color: var(--gold); margin: 0;">THI√äN H√Ä TRI TH·ª®C</h1>
                <p style="font-size: 24px; color: #ccc;">Nhi·ªám v·ª•: Chinh ph·ª•c H·ªá M·∫∑t Tr·ªùi</p>
                <div style="text-align: left; background: rgba(255,255,255,0.1); padding: 20px; margin: 20px; border-radius: 10px; font-size: 20px;">
                    1. üõ∏ <b>L√°i T√†u:</b> D√πng ph√≠m m≈©i t√™n ho·∫∑c n√∫t ·∫£o ƒë·ªÉ t√¨m h√†nh tinh.<br>
                    2. ü™ê <b>Chinh Ph·ª•c:</b> ƒê·ª•ng v√†o h√†nh tinh v√† tr·∫£ l·ªùi ƒë√∫ng <b>3 c√¢u h·ªèi</b>.<br>
                    3. ‚òÄÔ∏è <b>Boss Cu·ªëi:</b> Sau khi xong 8 h√†nh tinh, M·∫∑t Tr·ªùi & M·∫∑t TrƒÉng xu·∫•t hi·ªán.<br>
                    4. üèÜ <b>Chi·∫øn Th·∫Øng:</b> Tr·∫£ l·ªùi 5 c√¢u h·ªèi ·ªü Boss ƒë·ªÉ ho√†n th√†nh.<br>
                    ‚è≥ <b>Th·ªùi Gian:</b> 5 Ph√∫t.
                </div>
                <button class="start-btn" onclick="startGame()">KH·ªûI H√ÄNH NGAY</button>
            </div>
        </div>

        <div id="quiz-modal" class="modal">
            <div class="dialog-box" id="quiz-box">
                <div class="planet-icon" id="q-icon">ü™ê</div>
                <h2 style="margin: 0; color: var(--accent);" id="q-planet-name">Sao H·ªèa</h2>
                <div class="question-progress">C√¢u h·ªèi: <span id="q-progress">1</span>/<span id="q-total">3</span></div>
                <div class="question-text" id="q-content">...</div>
                <div class="options-grid" id="q-options"></div>
            </div>
        </div>

        <div id="end-screen" class="modal">
            <div class="dialog-box">
                <h1 id="end-title" style="font-size: 60px;">TH√ÄNH C√îNG!</h1>
                <p id="end-msg" style="font-size: 28px;">B·∫°n ƒë√£ chinh ph·ª•c to√†n b·ªô H·ªá M·∫∑t Tr·ªùi!</p>
                <button class="ans-btn" style="width: 200px; background: var(--success);" onclick="location.reload()">CH∆†I L·∫†I</button>
            </div>
        </div>
    </div>

<script>
// --- DATA C√ÇU H·ªéI (100 C√ÇU) ---
const QUESTION_DB = [
    { s: "V·∫≠t L√≠", q: "T·ªëc ƒë·ªô √°nh s√°ng trong ch√¢n kh√¥ng l√† bao nhi√™u?", a: ["300.000 km/s", "340 m/s", "150.000 km/s", "3.000 km/s"], c: 0 },
    { s: "H√≥a H·ªçc", q: "N∆∞·ªõc (H2O) g·ªìm nh·ªØng nguy√™n t·ªë n√†o?", a: ["Hydro v√† Oxy", "Hydro v√† Cacbon", "Oxy v√† Nito", "Heli v√† Oxy"], c: 0 },
    { s: "Sinh H·ªçc", q: "ƒê·ªông v·∫≠t n√†o sau ƒë√¢y l√† ƒë·ªông v·∫≠t c√≥ v√∫?", a: ["C√° Heo", "C√° M·∫≠p", "C√° S·∫•u", "Chim C√°nh C·ª•t"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "H√†nh tinh n√†o g·∫ßn M·∫∑t Tr·ªùi nh·∫•t?", a: ["Sao Th·ªßy", "Sao Kim", "Tr√°i ƒê·∫•t", "Sao H·ªèa"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê·ªãnh lu·∫≠t b·∫£o to√†n nƒÉng l∆∞·ª£ng ph√°t bi·ªÉu g√¨?", a: ["NƒÉng l∆∞·ª£ng kh√¥ng t·ª± sinh ra", "NƒÉng l∆∞·ª£ng t·ª± sinh ra", "NƒÉng l∆∞·ª£ng bi·∫øn m·∫•t", "Kh√¥ng c√≥ ƒë√°p √°n"], c: 0 },
    { s: "H√≥a H·ªçc", q: "K√Ω hi·ªáu h√≥a h·ªçc c·ªßa V√†ng l√† g√¨?", a: ["Au", "Ag", "Fe", "Cu"], c: 0 },
    { s: "Sinh H·ªçc", q: "ADN n·∫±m ·ªü ƒë√¢u trong t·∫ø b√†o?", a: ["Nh√¢n t·∫ø b√†o", "M√†ng t·∫ø b√†o", "T·∫ø b√†o ch·∫•t", "L·ª•c l·∫°p"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê∆°n v·ªã ƒëo c∆∞·ªùng ƒë·ªô d√≤ng ƒëi·ªán l√† g√¨?", a: ["Ampe", "Volt", "Ohm", "Watt"], c: 0 },
    { s: "H√≥a H·ªçc", q: "pH = 7 l√† m√¥i tr∆∞·ªùng g√¨?", a: ["Trung t√≠nh", "Axit", "Bazo", "Mu·ªëi"], c: 0 },
    { s: "Sinh H·ªçc", q: "Lo√†i n√†o ƒë∆∞·ª£c coi l√† vua c·ªßa r·ª´ng xanh?", a: ["S∆∞ t·ª≠", "H·ªï", "B√°o", "Voi"], c: 0 },
    { s: "To√°n", q: "S·ªë Pi x·∫•p x·ªâ b·∫±ng bao nhi√™u?", a: ["3.14", "3.15", "3.12", "3.16"], c: 0 },
    { s: "To√°n", q: "CƒÉn b·∫≠c hai c·ªßa 144 l√†?", a: ["12", "14", "10", "16"], c: 0 },
    { s: "To√°n", q: "T·ªïng 3 g√≥c trong m·ªôt tam gi√°c b·∫±ng?", a: ["180 ƒë·ªô", "360 ƒë·ªô", "90 ƒë·ªô", "100 ƒë·ªô"], c: 0 },
    { s: "To√°n", q: "S·ªë nguy√™n t·ªë nh·ªè nh·∫•t l√†?", a: ["2", "1", "3", "0"], c: 0 },
    { s: "To√°n", q: "H√¨nh b√¨nh h√†nh c√≥ hai ƒë∆∞·ªùng ch√©o...", a: ["C·∫Øt nhau t·∫°i trung ƒëi·ªÉm", "B·∫±ng nhau", "Vu√¥ng g√≥c", "Song song"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Chi·∫øn th·∫Øng B·∫°ch ƒê·∫±ng nƒÉm 938 do ai l√£nh ƒë·∫°o?", a: ["Ng√¥ Quy·ªÅn", "Tr·∫ßn H∆∞ng ƒê·∫°o", "L√Ω Th∆∞·ªùng Ki·ªát", "ƒêinh B·ªô Lƒ©nh"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Qu·ªëc hi·ªáu ƒë·∫ßu ti√™n c·ªßa n∆∞·ªõc ta l√† g√¨?", a: ["VƒÉn Lang", "√Çu L·∫°c", "V·∫°n Xu√¢n", "ƒê·∫°i C·ªì Vi·ªát"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "B√°c H·ªì ƒë·ªçc Tuy√™n ng√¥n ƒë·ªôc l·∫≠p v√†o ng√†y n√†o?", a: ["2/9/1945", "30/4/1975", "7/5/1954", "19/5/1890"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Tri·ªÅu ƒë·∫°i n√†o t·ªìn t·∫°i l√¢u nh·∫•t trong l·ªãch s·ª≠ Vi·ªát Nam?", a: ["Nh√† H·∫≠u L√™", "Nh√† L√Ω", "Nh√† Tr·∫ßn", "Nh√† Nguy·ªÖn"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Ch√¢u l·ª•c n√†o c√≥ di·ªán t√≠ch l·ªõn nh·∫•t th·∫ø gi·ªõi?", a: ["Ch√¢u √Å", "Ch√¢u Phi", "Ch√¢u M·ªπ", "Ch√¢u √Çu"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "S√¥ng n√†o d√†i nh·∫•t th·∫ø gi·ªõi?", a: ["S√¥ng Nile", "S√¥ng Amazon", "S√¥ng M√™ K√¥ng", "S√¥ng D∆∞∆°ng T·ª≠"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "ƒê·ªânh n√∫i cao nh·∫•t Vi·ªát Nam l√†?", a: ["Fansipan", "Pu Si Lung", "Putaleng", "Ng·ªçc Linh"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Truy·ªán Ki·ªÅu l√† t√°c ph·∫©m c·ªßa ai?", a: ["Nguy·ªÖn Du", "Nguy·ªÖn Tr√£i", "H·ªì Xu√¢n H∆∞∆°ng", "Nguy·ªÖn Khuy·∫øn"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "'S√¥ng n√∫i n∆∞·ªõc Nam' ƒë∆∞·ª£c coi l√† g√¨?", a: ["B·∫£n tuy√™n ng√¥n ƒë·ªôc l·∫≠p ƒë·∫ßu ti√™n", "B√†i th∆° t√¨nh", "H·ªãch t∆∞·ªõng sƒ©", "C√°o b√¨nh ng√¥"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Nh√¢n v·∫≠t Ch√≠ Ph√®o l√† c·ªßa nh√† vƒÉn n√†o?", a: ["Nam Cao", "Ng√¥ T·∫•t T·ªë", "V≈© Tr·ªçng Ph·ª•ng", "Kim L√¢n"], c: 0 },
    { s: "GDCD", q: "ƒê√®n t√≠n hi·ªáu giao th√¥ng c√≥ m·∫•y m√†u?", a: ["3", "2", "4", "5"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Con 'M√®o' trong ti·∫øng Anh l√† g√¨?", a: ["Cat", "Dog", "Bird", "Fish"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ 'Library' nghƒ©a l√† g√¨?", a: ["Th∆∞ vi·ªán", "Nh√† s√°ch", "Tr∆∞·ªùng h·ªçc", "Ph√≤ng h·ªçc"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Qu√° kh·ª© c·ªßa 'Go' l√†?", a: ["Went", "Gone", "Goes", "Going"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "CPU l√† vi·∫øt t·∫Øt c·ªßa g√¨?", a: ["Central Processing Unit", "Central Power Unit", "Computer Process Unit", "Control Power Unit"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Ph√≠m t·∫Øt Copy l√† g√¨?", a: ["Ctrl + C", "Ctrl + V", "Ctrl + X", "Ctrl + Z"], c: 0 },
    { s: "Th·ªÉ Thao", q: "M√¥n th·ªÉ thao vua l√† m√¥n n√†o?", a: ["B√≥ng ƒë√°", "B√≥ng r·ªï", "B∆°i l·ªôi", "ƒêi·ªÅn kinh"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "N·ªët La c√≥ k√Ω hi·ªáu ch·ªØ c√°i l√†?", a: ["A", "B", "C", "D"], c: 0 },
    { s: "·∫®m Th·ª±c", q: "Ph·ªü l√† m√≥n ƒÉn ƒë·∫∑c tr∆∞ng c·ªßa n∆∞·ªõc n√†o?", a: ["Vi·ªát Nam", "Th√°i Lan", "Trung Qu·ªëc", "Nh·∫≠t B·∫£n"], c: 0 },
    { s: "Sinh H·ªçc", q: "L√° c√¢y c√≥ m√†u xanh l√† do ch·ª©a ch·∫•t g√¨?", a: ["Di·ªáp l·ª•c", "Xenlulozo", "Tinh b·ªôt", "Vitamin"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Kh√≠ n√†o c·∫ßn thi·∫øt cho s·ª± ch√°y?", a: ["Oxy", "Nito", "Hidro", "Cacbonic"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "B√°c H·ªì ra ƒëi t√¨m ƒë∆∞·ªùng c·ª©u n∆∞·ªõc nƒÉm n√†o?", a: ["1911", "1930", "1945", "1890"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Th·ªß ƒë√¥ c·ªßa Vi·ªát Nam l√† g√¨?", a: ["H√† N·ªôi", "TP. H·ªì Ch√≠ Minh", "Hu·∫ø", "ƒê√† N·∫µng"], c: 0 },
    { s: "To√°n", q: "M·ªôt h√¨nh vu√¥ng c√≥ m·∫•y c·∫°nh b·∫±ng nhau?", a: ["4", "2", "3", "0"], c: 0 },
    { s: "V·∫≠t L√≠", q: "ƒê∆°n v·ªã ƒëo l·ª±c l√† g√¨?", a: ["Newton (N)", "Kg", "M√©t (m)", "L√≠t (l)"], c: 0 },
    { s: "H√≥a H·ªçc", q: "CTHH c·ªßa kh√≠ Cacbonic l√†?", a: ["CO2", "CO", "O2", "C2O"], c: 0 },
    { s: "Sinh H·ªçc", q: "Con ng∆∞·ªùi c√≥ bao nhi√™u ƒë√¥i nhi·ªÖm s·∫Øc th·ªÉ?", a: ["23", "24", "46", "22"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "D√£y n√∫i n√†o cao nh·∫•t th·∫ø gi·ªõi?", a: ["Himalaya", "Tr∆∞·ªùng S∆°n", "Andes", "Alps"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Th√°nh Gi√≥ng d√πng g√¨ ƒë·ªÉ ƒë√°nh gi·∫∑c?", a: ["Tre ng√†", "S√∫ng th·∫ßn c√¥ng", "N·ªè th·∫ßn", "G∆∞∆°m th·∫ßn"], c: 0 },
    { s: "To√°n", q: "K·∫øt qu·∫£ c·ªßa 10 chia 2 l√†?", a: ["5", "20", "12", "8"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Nhi·ªát ƒë·ªô s√¥i c·ªßa n∆∞·ªõc l√†?", a: ["100 ƒë·ªô C", "0 ƒë·ªô C", "50 ƒë·ªô C", "37 ƒë·ªô C"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Mu·ªëi ƒÉn c√≥ v·ªã g√¨?", a: ["M·∫∑n", "Ng·ªçt", "Chua", "ƒê·∫Øng"], c: 0 },
    { s: "Sinh H·ªçc", q: "Tim ng∆∞·ªùi c√≥ m·∫•y ngƒÉn?", a: ["4", "2", "3", "5"], c: 0 },
    { s: "Ti·∫øng Anh", q: "Hello nghƒ©a l√† g√¨?", a: ["Xin ch√†o", "T·∫°m bi·ªát", "C·∫£m ∆°n", "Xin l·ªói"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "RAM l√† b·ªô nh·ªõ g√¨?", a: ["Truy c·∫≠p ng·∫´u nhi√™n", "Ch·ªâ ƒë·ªçc", "L∆∞u tr·ªØ d√†i h·∫°n", "·∫¢o"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "N∆∞·ªõc n√†o c√≥ di·ªán t√≠ch l·ªõn nh·∫•t th·∫ø gi·ªõi?", a: ["Nga", "M·ªπ", "Trung Qu·ªëc", "Canada"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Chi·∫øn d·ªãch ƒêi·ªán Bi√™n Ph·ªß k·∫øt th√∫c nƒÉm n√†o?", a: ["1954", "1975", "1945", "1972"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Oxy chi·∫øm bao nhi√™u ph·∫ßn trƒÉm kh√¥ng kh√≠?", a: ["21%", "78%", "19%", "62%"], c: 0 },
    { s: "V·∫≠t L√≠", q: "L·ª±c h·∫•p d·∫´n gi√∫p ch√∫ng ta l√†m g√¨?", a: ["ƒê·ª©ng tr√™n m·∫∑t ƒë·∫•t", "Bay l√™n tr·ªùi", "B∆°i l·ªôi", "Kh√¥ng t√°c d·ª•ng"], c: 0 },
    { s: "Sinh H·ªçc", q: "Vitamin A t·ªët cho b·ªô ph·∫≠n n√†o?", a: ["M·∫Øt", "X∆∞∆°ng", "Da", "Tim"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Khi g·∫∑p l·∫°nh, n∆∞·ªõc s·∫Ω chuy·ªÉn sang tr·∫°ng th√°i n√†o?", a: ["R·∫Øn (ƒê√°)", "L·ªèng", "Kh√≠", "Plasma"], c: 0 },
    { s: "V·∫≠t L√≠", q: "Nam ch√¢m h√∫t kim lo·∫°i n√†o m·∫°nh nh·∫•t?", a: ["S·∫Øt", "Nh√¥m", "ƒê·ªìng", "V√†ng"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Kh√≠ n√†o nh·∫π nh·∫•t trong c√°c kh√≠ sau?", a: ["Hidro", "Oxy", "Cacbonic", "Nito"], c: 0 },
    { s: "H√≥a H·ªçc", q: "Kim c∆∞∆°ng ƒë∆∞·ª£c t·∫°o th√†nh t·ª´ nguy√™n t·ªë n√†o?", a: ["Cacbon", "S·∫Øt", "V√†ng", "Silic"], c: 0 },
    { s: "Sinh H·ªçc", q: "Con v·∫≠t n√†o sau ƒë√¢y ƒë·∫ª tr·ª©ng?", a: ["G√†", "Ch√≥", "M√®o", "L·ª£n"], c: 0 },
    { s: "Sinh H·ªçc", q: "B·ªô ph·∫≠n n√†o tr√™n c∆° th·ªÉ ng∆∞·ªùi d√πng ƒë·ªÉ l·ªçc m√°u?", a: ["Th·∫≠n", "Tim", "D·∫° d√†y", "Ph·ªïi"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "H√†nh tinh n√†o l·ªõn nh·∫•t trong H·ªá M·∫∑t Tr·ªùi?", a: ["Sao M·ªôc", "Sao Th·ªï", "Tr√°i ƒê·∫•t", "Sao H·ªèa"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "M·∫∑t TrƒÉng l√† g√¨ c·ªßa Tr√°i ƒê·∫•t?", a: ["V·ªá tinh t·ª± nhi√™n", "H√†nh tinh", "Ng√¥i sao", "Thi√™n th·∫°ch"], c: 0 },
    { s: "To√°n", q: "M·ªôt gi·ªù c√≥ bao nhi√™u ph√∫t?", a: ["60 ph√∫t", "100 ph√∫t", "24 ph√∫t", "30 ph√∫t"], c: 0 },
    { s: "To√°n", q: "H√¨nh tr√≤n c√≥ bao nhi√™u c·∫°nh?", a: ["0", "1", "2", "V√¥ s·ªë"], c: 0 },
    { s: "To√°n", q: "K·∫øt qu·∫£ c·ªßa ph√©p t√≠nh 7 x 8 l√†?", a: ["56", "48", "64", "54"], c: 0 },
    { s: "To√°n", q: "G√≥c vu√¥ng c√≥ s·ªë ƒëo l√† bao nhi√™u ƒë·ªô?", a: ["90 ƒë·ªô", "60 ƒë·ªô", "180 ƒë·ªô", "45 ƒë·ªô"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "V·ªã vua n√†o d·ªùi ƒë√¥ v·ªÅ ThƒÉng Long nƒÉm 1010?", a: ["L√Ω Th√°i T·ªï", "ƒêinh Ti√™n Ho√†ng", "L√™ L·ª£i", "Tr·∫ßn H∆∞ng ƒê·∫°o"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Hai B√† Tr∆∞ng c∆∞·ª°i con v·∫≠t g√¨ ra tr·∫≠n?", a: ["Voi", "Ng·ª±a", "Tr√¢u", "H·ªï"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "T√™n n∆∞·ªõc Vi·ªát Nam c√≥ t·ª´ th·ªùi vua n√†o?", a: ["Gia Long", "Minh M·∫°ng", "B·∫£o ƒê·∫°i", "Quang Trung"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Vi·ªát Nam c√≥ h√¨nh d·∫°ng ch·ªØ c√°i g√¨?", a: ["Ch·ªØ S", "Ch·ªØ I", "Ch·ªØ O", "Ch·ªØ U"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "ƒê·∫°i d∆∞∆°ng n√†o nh·ªè nh·∫•t th·∫ø gi·ªõi?", a: ["B·∫Øc BƒÉng D∆∞∆°ng", "·∫§n ƒê·ªô D∆∞∆°ng", "ƒê·∫°i T√¢y D∆∞∆°ng", "Th√°i B√¨nh D∆∞∆°ng"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Th√†nh ph·ªë n√†o ƒë∆∞·ª£c m·ªánh danh l√† Th√†nh ph·ªë Hoa ph∆∞·ª£ng ƒë·ªè?", a: ["H·∫£i Ph√≤ng", "ƒê√† N·∫µng", "C·∫ßn Th∆°", "Hu·∫ø"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "T√°c gi·∫£ c·ªßa t√°c ph·∫©m 'D·∫ø M√®n phi√™u l∆∞u k√Ω' l√† ai?", a: ["T√¥ Ho√†i", "Nam Cao", "Xu√¢n Di·ªáu", "Th·∫°ch Lam"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Trong truy·ªán T·∫•m C√°m, T·∫•m nu√¥i con c√° g√¨?", a: ["C√° B·ªëng", "C√° Ch√©p", "C√° V√†ng", "C√° R√¥"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Ai l√† ng∆∞·ªùi s√°ng t√°c b√†i 'Ti·∫øn qu√¢n ca' (Qu·ªëc ca)?", a: ["VƒÉn Cao", "Ph·∫°m Tuy√™n", "Tr·ªãnh C√¥ng S∆°n", "Ho√†ng Vi·ªát"], c: 0 },
    { s: "GDCD", q: "C√¥ng d√¢n Vi·ªát Nam ƒë·ªß bao nhi√™u tu·ªïi ƒë∆∞·ª£c quy·ªÅn b·∫ßu c·ª≠?", a: ["18 tu·ªïi", "16 tu·ªïi", "20 tu·ªïi", "21 tu·ªïi"], c: 0 },
    { s: "GDCD", q: "S·ªë ƒëi·ªán tho·∫°i kh·∫©n c·∫•p c·ªßa C·∫£nh s√°t l√† g√¨?", a: ["113", "114", "115", "111"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ 'Apple' trong ti·∫øng Vi·ªát nghƒ©a l√† g√¨?", a: ["Qu·∫£ t√°o", "Qu·∫£ cam", "Qu·∫£ chu·ªëi", "Qu·∫£ d∆∞a"], c: 0 },
    { s: "Ti·∫øng Anh", q: "S·ªë 20 trong ti·∫øng Anh vi·∫øt l√† g√¨?", a: ["Twenty", "Twelve", "Two", "Ten"], c: 0 },
    { s: "Ti·∫øng Anh", q: "T·ª´ n√†o tr√°i nghƒ©a v·ªõi 'Big' (To)?", a: ["Small", "Tall", "Long", "Fat"], c: 0 },
    { s: "Ti·∫øng Anh", q: "'Good morning' ƒë∆∞·ª£c d√πng ƒë·ªÉ ch√†o v√†o l√∫c n√†o?", a: ["Bu·ªïi s√°ng", "Bu·ªïi chi·ªÅu", "Bu·ªïi t·ªëi", "Ban ƒë√™m"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Thi·∫øt b·ªã n√†o d√πng ƒë·ªÉ nh·∫≠p k√Ω t·ª± v√†o m√°y t√≠nh?", a: ["B√†n ph√≠m", "M√†n h√¨nh", "Loa", "M√°y in"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "H·ªá ƒëi·ªÅu h√†nh ph·ªï bi·∫øn tr√™n m√°y t√≠nh l√† g√¨?", a: ["Windows", "Android", "iOS", "Java"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "Ph√≠m t·∫Øt ƒë·ªÉ 'D√°n' (Paste) l√† g√¨?", a: ["Ctrl + V", "Ctrl + C", "Ctrl + P", "Ctrl + S"], c: 0 },
    { s: "Th·ªÉ Thao", q: "Trong b√≥ng ƒë√°, m·ªói ƒë·ªôi c√≥ bao nhi√™u c·∫ßu th·ªß tr√™n s√¢n?", a: ["11", "7", "5", "12"], c: 0 },
    { s: "Th·ªÉ Thao", q: "M√¥n th·ªÉ thao n√†o s·ª≠ d·ª•ng v·ª£t v√† qu·∫£ c·∫ßu?", a: ["C·∫ßu l√¥ng", "B√≥ng b√†n", "Tennis", "B√≥ng chuy·ªÅn"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "ƒê√†n Piano c√≥ c√°c ph√≠m m√†u g√¨?", a: ["Tr·∫Øng v√† ƒêen", "ƒê·ªè v√† V√†ng", "Xanh v√† Tr·∫Øng", "N√¢u v√† ƒêen"], c: 0 },
    { s: "·∫®m Th·ª±c", q: "M√≥n kim chi l√† ƒë·∫∑c s·∫£n c·ªßa n∆∞·ªõc n√†o?", a: ["H√†n Qu·ªëc", "Nh·∫≠t B·∫£n", "Trung Qu·ªëc", "Th√°i Lan"], c: 0 },
    { s: "·∫®m Th·ª±c", q: "Nguy√™n li·ªáu ch√≠nh ƒë·ªÉ l√†m b√°nh ch∆∞ng l√† g√¨?", a: ["G·∫°o n·∫øp", "G·∫°o t·∫ª", "B·ªôt m√¨", "Khoai t√¢y"], c: 0 },
    { s: "Sinh H·ªçc", q: "C√¢y x∆∞∆°ng r·ªìng th∆∞·ªùng s·ªëng ·ªü ƒë√¢u?", a: ["Sa m·∫°c", "R·ª´ng m∆∞a", "ƒê·∫ßm l·∫ßy", "B·∫Øc c·ª±c"], c: 0 },
    { s: "Sinh H·ªçc", q: "Con v·∫≠t n√†o ƒë∆∞·ª£c g·ªçi l√† 'Ch√∫a s∆°n l√¢m'?", a: ["H·ªï", "S∆∞ t·ª≠", "G·∫•u", "B√°o"], c: 0 },
    { s: "V·∫≠t L√≠", q: "D·ª•ng c·ª• n√†o d√πng ƒë·ªÉ ƒëo nhi·ªát ƒë·ªô?", a: ["Nhi·ªát k·∫ø", "Th∆∞·ªõc k·∫ª", "C√¢n", "ƒê·ªìng h·ªì"], c: 0 },
    { s: "H√≥a H·ªçc", q: "S·∫Øt c√≥ k√Ω hi·ªáu h√≥a h·ªçc l√† g√¨?", a: ["Fe", "Cu", "Zn", "Al"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "Th·ªß ƒë√¥ c·ªßa n∆∞·ªõc Ph√°p l√† g√¨?", a: ["Paris", "London", "Berlin", "Rome"], c: 0 },
    { s: "ƒê·ªãa L√≠", q: "N∆∞·ªõc n√†o c√≥ d√¢n s·ªë ƒë√¥ng nh·∫•t th·∫ø gi·ªõi (nƒÉm 2023)?", a: ["·∫§n ƒê·ªô", "Trung Qu·ªëc", "M·ªπ", "Nga"], c: 0 },
    { s: "L·ªãch S·ª≠", q: "Chi·∫øn th·∫Øng ƒêi·ªán Bi√™n Ph·ªß tr√™n kh√¥ng di·ªÖn ra nƒÉm n√†o?", a: ["1972", "1954", "1968", "1975"], c: 0 },
    { s: "To√°n", q: "S·ªë t·ª± nhi√™n nh·ªè nh·∫•t l√† s·ªë m·∫•y?", a: ["0", "1", "2", "-1"], c: 0 },
    { s: "To√°n", q: "H√¨nh tam gi√°c ƒë·ªÅu c√≥ m·∫•y c·∫°nh b·∫±ng nhau?", a: ["3", "2", "0", "4"], c: 0 },
    { s: "GDCD", q: "Khi ƒëi xe m√°y b·∫Øt bu·ªôc ph·∫£i ƒë·ªôi g√¨?", a: ["M≈© b·∫£o hi·ªÉm", "M≈© l∆∞·ª°i trai", "N√≥n l√°", "Kh√¥ng c·∫ßn ƒë·ªôi"], c: 0 },
    { s: "VƒÉn H·ªçc", q: "Truy·ªán 'Doraemon' xu·∫•t x·ª© t·ª´ n∆∞·ªõc n√†o?", a: ["Nh·∫≠t B·∫£n", "H√†n Qu·ªëc", "M·ªπ", "Vi·ªát Nam"], c: 0 },
    { s: "C√¥ng Ngh·ªá", q: "WWW l√† vi·∫øt t·∫Øt c·ªßa t·ª´ g√¨?", a: ["World Wide Web", "World Web Wide", "Wide World Web", "Web World Wide"], c: 0 },
    { s: "Th·ªÉ Thao", q: "SEA Games l√† ƒë·∫°i h·ªôi th·ªÉ thao khu v·ª±c n√†o?", a: ["ƒê√¥ng Nam √Å", "Ch√¢u √Å", "Ch√¢u √Çu", "Th·∫ø gi·ªõi"], c: 0 },
    { s: "√Çm Nh·∫°c", q: "B√†i h√°t 'Em l√† b√¥ng h·ªìng nh·ªè' do ai s√°ng t√°c?", a: ["Tr·ªãnh C√¥ng S∆°n", "Ph·∫°m Tuy√™n", "Phong Nh√£", "L∆∞u H·ªØu Ph∆∞·ªõc"], c: 0 },
    { s: "Thi√™n VƒÉn", q: "M·∫∑t Tr·ªùi l√† m·ªôt...", a: ["Ng√¥i sao", "H√†nh tinh", "V·ªá tinh", "Thi√™n th·∫°ch"], c: 0 }
];


// --- C·∫§U H√åNH GAME ---
const MAP_W = 3500; 
const MAP_H = 3000;
let timeLeft = 300; 

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
let cw, ch;

let gameState = 'MENU';
let player = { x: 200, y: MAP_H/2, r: 25, speed: 6, angle: 0, dx: 0, dy: 0 };
let camera = { x: 0, y: 0 };
let keys = {};

// D·ªØ li·ªáu h√†nh tinh
let planets = [];
let sun = {}; 
let moon = {};
let asteroids = [];
let stars = [];
let meteors = [];
let particles = [];

let questionQueue = []; 
let activePlanet = null; 
let questionStreak = 0; 
let conqueredCount = 0; 
let phase = 1; 
let timerInterval;

// --- INIT ---
function init() {
    resize();
    window.addEventListener('resize', resize);
    setupInputs();
    requestAnimationFrame(gameLoop);
}

function resize() {
    cw = canvas.width = window.innerWidth;
    ch = canvas.height = window.innerHeight;
}

function setupInputs() {
    window.addEventListener('keydown', e => keys[e.code] = true);
    window.addEventListener('keyup', e => keys[e.code] = false);

    const bindTouch = (cls, code) => {
        const el = document.querySelector(cls);
        el.addEventListener('touchstart', (e) => { e.preventDefault(); keys[code] = true; });
        el.addEventListener('touchend', (e) => { e.preventDefault(); keys[code] = false; });
    };
    bindTouch('.d-up', 'ArrowUp'); bindTouch('.d-down', 'ArrowDown');
    bindTouch('.d-left', 'ArrowLeft'); bindTouch('.d-right', 'ArrowRight');
    
    const boostBtn = document.getElementById('btn-boost');
    boostBtn.addEventListener('touchstart', (e) => { e.preventDefault(); keys['Space'] = true; });
    boostBtn.addEventListener('touchend', (e) => { e.preventDefault(); keys['Space'] = false; });
}

function generateWorld() {
    planets = [];
    const planetData = [
        {n: "Sao Th·ªßy", type: "mercury", r: 50},
        {n: "Sao Kim", type: "venus", r: 60},
        {n: "Tr√°i ƒê·∫•t", type: "earth", r: 70},
        {n: "Sao H·ªèa", type: "mars", r: 55},
        {n: "Sao M·ªôc", type: "jupiter", r: 110},
        {n: "Sao Th·ªï", type: "saturn", r: 90, ring: true},
        {n: "Sao T.V∆∞∆°ng", type: "uranus", r: 70},
        {n: "Sao H.V∆∞∆°ng", type: "neptune", r: 70}
    ];

    for(let i=0; i<8; i++) {
        let px, py, safe;
        do {
            safe = true;
            px = 400 + Math.random() * (MAP_W - 800);
            py = 400 + Math.random() * (MAP_H - 800);
            if(Math.hypot(px - 200, py - MAP_H/2) < 400) safe = false;
            for(let p of planets) {
                if(Math.hypot(px - p.x, py - p.y) < 400) safe = false;
            }
        } while(!safe);

        planets.push({
            x: px, y: py, ...planetData[i], 
            conquered: false, req: 3, 
            angle: 0, selfAngle: Math.random() * Math.PI * 2 
        });
    }

    sun = { x: MAP_W/2, y: MAP_H/2, r: 150, n: "M·∫∑t Tr·ªùi", type: "sun", active: false, conquered: false, req: 5, selfAngle: 0 };
    moon = { x: MAP_W/2, y: MAP_H/2, r: 80, n: "M·∫∑t TrƒÉng", type: "moon", active: false, conquered: false, req: 5, selfAngle: 0 };

    asteroids = [];
    for(let i=0; i<30; i++) {
        asteroids.push({
            x: Math.random()*MAP_W, y: Math.random()*MAP_H,
            r: 20 + Math.random()*30,
            dx: (Math.random()-0.5)*1.5, dy: (Math.random()-0.5)*1.5,
            rot: Math.random(), rSpeed: (Math.random()-0.5)*0.05
        });
    }

    stars = [];
    for(let i=0; i<600; i++) {
        stars.push({x: Math.random()*MAP_W, y: Math.random()*MAP_H, s: Math.random()*3, a: Math.random(), da: (Math.random()-0.5)*0.03});
    }
}

function startGame() {
    document.getElementById('start-screen').classList.remove('active');
    generateWorld();
    conqueredCount = 0; phase = 1; timeLeft = 300;
    player.x = 200; player.y = MAP_H/2;
    gameState = 'PLAY';
    
    if(timerInterval) clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if(gameState === 'PLAY') {
            timeLeft--;
            updateTimerUI();
            if(timeLeft <= 0) endGame(false);
        }
    }, 1000);
    updateHUD();
}

function updateTimerUI() {
    let m = Math.floor(timeLeft / 60);
    let s = timeLeft % 60;
    let timeStr = `${m < 10 ? '0'+m : m}:${s < 10 ? '0'+s : s}`;
    const el = document.getElementById('timer');
    el.innerText = timeStr;
    if(timeLeft < 60) el.classList.add('critical');
    else el.classList.remove('critical');
}

function gameLoop() {
    if(gameState === 'PLAY') update();
    draw();
    requestAnimationFrame(gameLoop);
}

function update() {
    let speed = keys['Space'] ? 12 : 6; 
    player.dx = 0; player.dy = 0;

    if (keys['ArrowUp']) player.dy = -speed;
    if (keys['ArrowDown']) player.dy = speed;
    if (keys['ArrowLeft']) player.dx = -speed;
    if (keys['ArrowRight']) player.dx = speed;

    player.x += player.dx; player.y += player.dy;
    player.x = Math.max(player.r, Math.min(MAP_W - player.r, player.x));
    player.y = Math.max(player.r, Math.min(MAP_H - player.r, player.y));

    camera.x += (player.x - cw/2 - camera.x) * 0.1;
    camera.y += (player.y - ch/2 - camera.y) * 0.1;
    camera.x = Math.max(0, Math.min(MAP_W - cw, camera.x));
    camera.y = Math.max(0, Math.min(MAP_H - ch, camera.y));

    if (player.dx !== 0 || player.dy !== 0) {
        player.angle = Math.atan2(player.dy, player.dx);
        spawnThrust();
    }

    // Stars & Meteors
    for(let s of stars) {
        s.a += s.da;
        if(s.a > 1 || s.a < 0.2) s.da = -s.da;
    }
    if(Math.random() < 0.03) meteors.push({x: Math.random()*MAP_W, y: Math.random()*MAP_H/2, vx: -12-Math.random()*15, vy: 6+Math.random()*8, life: 1.0});
    for(let i=meteors.length-1; i>=0; i--) {
        let m = meteors[i]; m.x += m.vx; m.y += m.vy; m.life -= 0.02;
        if(m.life <= 0) meteors.splice(i,1);
    }

    // Rotation
    for(let p of planets) p.selfAngle += 0.005;
    sun.selfAngle += 0.002; moon.selfAngle += 0.005;

    // Logic Phases
    if(phase === 1) {
        for(let p of planets) {
            if(!p.conquered && checkCollision(player, p)) { startQuiz(p); return; }
        }
        if(conqueredCount >= 8) startPhase2();
    } else {
        let time = Date.now() / 1500;
        moon.x = MAP_W/2 + Math.cos(time) * 400; moon.y = MAP_H/2 + Math.sin(time) * 400;
        
        planets.forEach((p, idx) => {
            let r = 700 + idx * 80;
            p.x = MAP_W/2 + Math.cos(time * 0.5 + idx) * r;
            p.y = MAP_H/2 + Math.sin(time * 0.5 + idx) * r;
        });

        if(!sun.conquered && checkCollision(player, sun)) startQuiz(sun);
        if(!moon.conquered && checkCollision(player, moon)) startQuiz(moon);
        if(sun.conquered && moon.conquered) endGame(true);
    }

    for(let a of asteroids) {
        a.x += a.dx; a.y += a.dy; a.rot += a.rSpeed;
        if(a.x < 0) a.x = MAP_W; if(a.x > MAP_W) a.x = 0;
        if(a.y < 0) a.y = MAP_H; if(a.y > MAP_H) a.y = 0;
        if(checkCollision(player, a)) {
            let ang = Math.atan2(player.y - a.y, player.x - a.x);
            player.x += Math.cos(ang) * 30; player.y += Math.sin(ang) * 30;
            spawnExplosion(player.x, player.y, 10, '#fff');
        }
    }

    for(let i=particles.length-1; i>=0; i--) {
        let p = particles[i]; p.x += p.vx; p.y += p.vy; p.l -= 0.05;
        if(p.l <= 0) particles.splice(i, 1);
    }
}

function checkCollision(c1, c2) { return Math.hypot(c1.x - c2.x, c1.y - c2.y) < c1.r + c2.r; }

function spawnThrust() {
    let bx = player.x - Math.cos(player.angle) * 30;
    let by = player.y - Math.sin(player.angle) * 30;
    particles.push({x: bx, y: by, vx: (Math.random()-0.5)*2, vy: (Math.random()-0.5)*2, l: 1, c: '#00f3ff'});
}

function spawnExplosion(x, y, count, color) {
    for(let i=0; i<count; i++) particles.push({x: x, y: y, vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12, l: 1, c: color});
}

function startQuiz(target) {
    gameState = 'MODAL';
    activePlanet = target;
    questionStreak = 0;
    questionQueue = [];
    let tempDB = [...QUESTION_DB].sort(() => 0.5 - Math.random());
    for(let i=0; i<target.req; i++) questionQueue.push(tempDB[i]);

    document.getElementById('quiz-modal').classList.add('active');
    document.getElementById('q-planet-name').innerText = target.n;
    showNextQuestion();
}

function showNextQuestion() {
    if(questionStreak >= activePlanet.req) { finishPlanet(); return; }
    let q = questionQueue[questionStreak];
    document.getElementById('q-progress').innerText = questionStreak + 1;
    document.getElementById('q-total').innerText = activePlanet.req;
    document.getElementById('q-content').innerHTML = `<span style="background:#444; padding:2px 8px; border-radius:4px; font-size:20px;">${q.s}</span><br>${q.q}`;
    
    const grid = document.getElementById('q-options');
    grid.innerHTML = '';
    q.a.forEach((ans, idx) => {
        let btn = document.createElement('button');
        btn.className = 'ans-btn';
        btn.innerText = ans;
        btn.onclick = () => checkAnswer(idx, q.c, btn);
        grid.appendChild(btn);
    });
}

function checkAnswer(selected, correct, btn) {
    let btns = document.querySelectorAll('.ans-btn');
    btns.forEach(b => b.disabled = true);
    if(selected === correct) {
        btn.style.background = 'var(--success)';
        questionStreak++;
        setTimeout(showNextQuestion, 800);
    } else {
        btn.style.background = 'var(--danger)';
        btns[correct].style.background = 'var(--success)'; 
        timeLeft -= 10; updateTimerUI();
        setTimeout(() => {
            let newQ = QUESTION_DB[Math.floor(Math.random() * QUESTION_DB.length)];
            questionQueue[questionStreak] = newQ;
            showNextQuestion();
        }, 1200);
    }
}

function finishPlanet() {
    document.getElementById('quiz-modal').classList.remove('active');
    gameState = 'PLAY';
    activePlanet.conquered = true;
    player.x += Math.cos(player.angle + Math.PI) * 150;
    player.y += Math.sin(player.angle + Math.PI) * 150;
    spawnExplosion(activePlanet.x, activePlanet.y, 50, '#fff');
    if(phase === 1) { conqueredCount++; updateHUD(); }
}

function startPhase2() {
    phase = 2; sun.active = true; moon.active = true;
    player.x = 200; player.y = 200;
    let overlay = document.createElement('div');
    overlay.style.cssText = "position:fixed;top:0;left:0;width:100%;height:100%;background:#fff;z-index:999;animation: flash 2s forwards;";
    document.body.appendChild(overlay);
    setTimeout(() => overlay.remove(), 2000);
}

function endGame(win) {
    gameState = 'OVER'; clearInterval(timerInterval);
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
    let endScreen = document.getElementById('end-screen');
    if(win) {
        document.getElementById('end-title').innerText = "V√î ƒê·ªäCH!";
        document.getElementById('end-title').style.color = "var(--success)";
        document.getElementById('end-msg').innerText = "V≈© tr·ª• ƒë√£ thu·ªôc v·ªÅ b·∫°n!";
    } else {
        document.getElementById('end-title').innerText = "H·∫æT GI·ªú!";
        document.getElementById('end-title').style.color = "var(--danger)";
        document.getElementById('end-msg').innerText = "H√£y th·ª≠ l·∫°i nh√©!";
    }
    endScreen.classList.add('active');
}

function updateHUD() { document.getElementById('conquered-count').innerText = conqueredCount; }

function draw() {
    let dx = -camera.x; let dy = -camera.y;
    ctx.fillStyle = 'var(--bg-color)'; ctx.fillRect(0, 0, cw, ch);
    ctx.save(); ctx.translate(dx, dy);

    // Stars
    for(let s of stars) {
        ctx.fillStyle = '#fff'; ctx.globalAlpha = s.a;
        ctx.beginPath(); ctx.arc(s.x, s.y, s.s, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1;

    // Meteors
    ctx.strokeStyle = '#fff'; ctx.lineWidth = 2;
    for(let m of meteors) {
        ctx.globalAlpha = m.life;
        ctx.beginPath(); ctx.moveTo(m.x, m.y); ctx.lineTo(m.x - m.vx, m.y - m.vy); ctx.stroke();
    }
    ctx.globalAlpha = 1;

    if(phase === 2) {
        ctx.strokeStyle = 'rgba(255,255,255,0.1)'; ctx.lineWidth = 2;
        ctx.beginPath(); ctx.arc(MAP_W/2, MAP_H/2, 300, 0, Math.PI*2); ctx.stroke();
        drawVisualPlanet(sun);
        drawVisualPlanet(moon);
    }

    for(let p of planets) drawVisualPlanet(p);

    // Asteroids
    for(let a of asteroids) {
        ctx.save(); ctx.translate(a.x, a.y); ctx.rotate(a.rot);
        ctx.fillStyle = '#7f8c8d'; ctx.shadowBlur = 10; ctx.shadowColor = '#000';
        ctx.beginPath(); ctx.moveTo(a.r, 0);
        for(let i=1; i<7; i++) {
            let angle = i * Math.PI * 2 / 7;
            let r = a.r * (0.8 + Math.random()*0.3);
            ctx.lineTo(Math.cos(angle)*r, Math.sin(angle)*r);
        }
        ctx.closePath(); ctx.fill();
        ctx.restore();
    }

    // Particles
    for(let p of particles) {
        ctx.globalAlpha = p.l; ctx.fillStyle = p.c;
        ctx.beginPath(); ctx.arc(p.x, p.y, 4, 0, Math.PI*2); ctx.fill();
    }
    ctx.globalAlpha = 1; ctx.shadowBlur = 0;

    // SHIP MODEL (Detailed)
    ctx.save();
    ctx.translate(player.x, player.y);
    ctx.rotate(player.angle);
    ctx.shadowBlur = 15; ctx.shadowColor = '#00f3ff';
    ctx.fillStyle = '#e74c3c'; 
    ctx.beginPath(); ctx.moveTo(-15, 20); ctx.lineTo(-25, 35); ctx.lineTo(10, 15); ctx.fill();
    ctx.beginPath(); ctx.moveTo(-15, -20); ctx.lineTo(-25, -35); ctx.lineTo(10, -15); ctx.fill();
    ctx.fillStyle = '#ecf0f1'; ctx.beginPath(); ctx.ellipse(5, 0, 35, 15, 0, 0, Math.PI*2); ctx.fill();
    ctx.fillStyle = '#3498db'; ctx.beginPath(); ctx.arc(10, -5, 10, 0, Math.PI*2); ctx.fill(); 
    if(keys['ArrowUp'] || keys['ArrowDown'] || keys['ArrowLeft'] || keys['ArrowRight']) {
        ctx.fillStyle = '#f1c40f';
        ctx.beginPath(); ctx.moveTo(-30, -8); ctx.lineTo(-50 - Math.random()*20, 0); ctx.lineTo(-30, 8); ctx.fill();
    }
    ctx.restore();

    ctx.restore();
}

// --- VISUAL RENDER REALISTIC (User Provided Logic) ---
function drawVisualPlanet(p) {
    if(p.conquered) ctx.globalAlpha = 0.5;
    
    ctx.save();
    ctx.translate(p.x, p.y);
    
    // 1. Draw Text (Stationary - Before Rotation)
    ctx.shadowBlur = 0;
    ctx.fillStyle = '#fff'; ctx.font = "bold 24px VT323"; ctx.textAlign = "center";
    ctx.fillText(p.n, 0, p.r + 35);
    if(p.conquered) {
        ctx.fillStyle = '#2ecc71'; ctx.font = '30px VT323';
        ctx.fillText("‚úì", 0, 0);
    }

    // 2. Rotate for Planet Body
    ctx.rotate(p.selfAngle);

    // 3. Draw Planet (Realistic)
    switch(p.type) {
        case 'mercury': drawGenericPlanet(p.r, ['#7f8c8d', '#95a5a6', '#bdc3c7'], true); break;
        case 'venus': drawAtmospherePlanet(p.r, '#e67e22', '#f1c40f', '#d35400'); break;
        case 'earth': drawEarth(p.r); break;
        case 'mars': drawMars(p.r); break;
        case 'jupiter': drawJupiter(p.r); break;
        case 'saturn': drawSaturn(p.r); break;
        case 'uranus': drawGenericPlanet(p.r, ['#AEEEEE', '#81D8D0'], false); break;
        case 'neptune': drawAtmospherePlanet(p.r, '#2980b9', '#3498db', '#ecf0f1'); break;
        case 'sun': drawSun(p.r); break;
        case 'moon': drawMoon(p.r); break;
        default: 
            let grad = ctx.createRadialGradient(-p.r/3, -p.r/3, 0, 0, 0, p.r);
            grad.addColorStop(0, '#aaa'); grad.addColorStop(1, '#333');
            ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, p.r, 0, Math.PI*2); ctx.fill();
    }

    ctx.restore();
    ctx.globalAlpha = 1;
}

// --- HELPER FUNCTIONS (REALISTIC) ---
function drawGenericPlanet(r, colors, hasCraters) {
    let grad = ctx.createRadialGradient(-r/3, -r/3, r/10, 0, 0, r);
    grad.addColorStop(0, colors[0]); grad.addColorStop(0.5, colors[1]); grad.addColorStop(1, '#2c3e50');
    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.fill();
    if(hasCraters) {
        ctx.save(); ctx.clip();
        for(let i=0; i<15; i++) {
            let cr = Math.random()*r/4; let cx = (Math.random()-0.5)*r*1.8; let cy = (Math.random()-0.5)*r*1.8;
            ctx.fillStyle = 'rgba(0,0,0,0.2)'; ctx.beginPath(); ctx.arc(cx, cy, cr, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();
    }
}

function drawAtmospherePlanet(r, base, light, dark) {
    let grad = ctx.createRadialGradient(-r/3, -r/3, 0, 0, 0, r);
    grad.addColorStop(0, light); grad.addColorStop(0.7, base); grad.addColorStop(1, dark);
    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.fill();
    ctx.save(); ctx.clip();
    ctx.globalAlpha = 0.3; ctx.fillStyle = '#fff';
    for(let i=0; i<5; i++) {
        ctx.beginPath(); ctx.ellipse(0, (Math.random()-0.5)*r, r*1.2, r/5, Math.random()*0.5, 0, Math.PI*2); ctx.fill();
    }
    ctx.restore();
}

function drawEarth(r) {
    let grad = ctx.createRadialGradient(-r/3, -r/3, 0, 0, 0, r);
    grad.addColorStop(0, '#3498db'); grad.addColorStop(1, '#2980b9');
    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.fill();
    ctx.save(); ctx.clip();
    ctx.fillStyle = '#27ae60';
    ctx.beginPath(); ctx.arc(-r/2, -r/4, r/2, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(r/3, r/5, r/1.8, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(r/2, -r/2, r/3, 0, Math.PI*2); ctx.fill();
    ctx.globalAlpha = 0.5; ctx.fillStyle = '#fff';
    for(let i=0; i<8; i++) {
        ctx.beginPath(); ctx.ellipse((Math.random()-0.5)*r*1.5, (Math.random()-0.5)*r*1.5, r/3, r/6, Math.random(), 0, Math.PI*2); ctx.fill();
    }
    ctx.restore();
}

function drawMars(r) {
    drawGenericPlanet(r, ['#e67e22', '#d35400'], true);
    ctx.save(); ctx.clip();
    ctx.fillStyle = '#fff';
    ctx.beginPath(); ctx.arc(0, -r + r/5, r/3, 0, Math.PI*2); ctx.fill();
    ctx.beginPath(); ctx.arc(0, r - r/5, r/3, 0, Math.PI*2); ctx.fill();
    ctx.restore();
}

function drawJupiter(r) {
    let grad = ctx.createRadialGradient(-r/3, -r/3, 0, 0, 0, r);
    grad.addColorStop(0, '#f39c12'); grad.addColorStop(1, '#c0392b');
    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.fill();
    ctx.save(); ctx.clip();
    let colors = ['rgba(165, 105, 79, 0.6)', 'rgba(230, 180, 140, 0.5)', 'rgba(120, 60, 40, 0.7)'];
    for(let i=-4; i<5; i++) {
        ctx.fillStyle = colors[Math.abs(i)%3];
        ctx.fillRect(-r, i*(r/5), r*2, r/10 + Math.random()*r/10);
    }
    ctx.fillStyle = 'rgba(150, 50, 30, 0.8)';
    ctx.beginPath(); ctx.ellipse(r/3, r/4, r/4, r/6, 0.2, 0, Math.PI*2); ctx.fill();
    ctx.restore();
}

function drawSaturn(r) {
    ctx.save();
    ctx.rotate(Math.PI / 6);
    ctx.save();
    ctx.scale(1, 0.3);
    ctx.beginPath(); ctx.arc(0, 0, r * 2.2, 0, Math.PI*2);
    let ringGrad = ctx.createRadialGradient(0,0,r*1.2, 0,0,r*2.2);
    ringGrad.addColorStop(0, 'rgba(180, 160, 130, 0)');
    ringGrad.addColorStop(0.1, 'rgba(180, 160, 130, 0.8)');
    ringGrad.addColorStop(0.5, 'rgba(220, 200, 170, 0.9)');
    ringGrad.addColorStop(1, 'rgba(180, 160, 130, 0)');
    ctx.fillStyle = ringGrad; ctx.fill();
    ctx.beginPath(); ctx.arc(0, 0, r * 1.7, 0, Math.PI*2);
    ctx.lineWidth = r/15; ctx.strokeStyle = 'rgba(0,0,0,0.5)'; ctx.stroke();
    ctx.restore();
    drawGenericPlanet(r, ['#e0cda5', '#b5a17a'], false);
    ctx.save();
    ctx.beginPath(); ctx.rect(-r*2.5, 0, r*5, r*3); ctx.clip();
    ctx.scale(1, 0.3);
    ctx.beginPath(); ctx.arc(0, 0, r * 2.2, 0, Math.PI*2);
    ctx.fillStyle = ringGrad; ctx.fill();
    ctx.beginPath(); ctx.arc(0, 0, r * 1.7, 0, Math.PI*2);
    ctx.lineWidth = r/15; ctx.strokeStyle = 'rgba(0,0,0,0.5)'; ctx.stroke();
    ctx.restore();
    ctx.restore();
}

function drawSun(r) {
    ctx.shadowBlur = 50; ctx.shadowColor = '#f1c40f';
    let grad = ctx.createRadialGradient(0, 0, r*0.2, 0, 0, r);
    grad.addColorStop(0, '#fff'); grad.addColorStop(0.2, '#f1c40f'); grad.addColorStop(1, '#e67e22');
    ctx.fillStyle = grad; ctx.beginPath(); ctx.arc(0, 0, r, 0, Math.PI*2); ctx.fill();
    ctx.shadowBlur = 0;
}

function drawMoon(r) {
    ctx.shadowBlur = 30; ctx.shadowColor = '#fff';
    drawGenericPlanet(r, ['#ecf0f1', '#bdc3c7'], true);
    ctx.shadowBlur = 0;
}

init();
</script>
</body>
</html>